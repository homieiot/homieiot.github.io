<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/img/homie-logo.png">
  <link rel="canonical" href="https://homieiot.github.io/specification/spec-core-v5_0_0-diff/">
  <title>The Homie convention</title>
  <link href="https://homieiot.github.io/scss/all.min.css" rel="stylesheet">


    <script type='text/javascript' src="https://homieiot.github.io/js/main.min.js"></script>

  <link rel="prefetch" href="specification/">
  <link rel="prefetch" href="implementations/">
  <link rel="prefetch" href="extensions/">
  <link rel="prefetch" href="get_involved/">
  <link rel="prefetch" href="license/">
</head>

<body>
    <div class="progress d-print-none"></div>
    <header class="text-center" style="margin-top:20px">
    <a href="https://github.com/homieiot/convention" title="homieiot/convention" class="md-source d-print-none" data-md-source="github">
      <div class="md-source__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 416 448" id="__github">
          <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
                8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
                18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
                19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
                18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
                304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
                2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
                38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
                37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
                82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
                1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
                0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
                30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
                46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
                99.5z"></path>
        </svg>
      </div>
      <div class="md-source__repository">
        homieiot/convention
        <div id="repofacts" class="md-source__facts"></div>
      </div>
    </a>
    <script>
      const el = document.getElementById("repofacts");
      var stargazers_count = sessionStorage.getItem('stargazers_count');
      var forks_count = sessionStorage.getItem('forks_count');
      if (stargazers_count !== null) {
        el.innerText = stargazers_count + " Stars · " + forks_count + " Forks"
      } else {
        const url = "https://api.github.com/repos/homieiot\/convention"
        fetch(url).then(response => response.json()).then(data => {
          if (!(data instanceof Object))
            throw new TypeError
          sessionStorage.setItem('stargazers_count', data.stargazers_count);
          sessionStorage.setItem('forks_count', data.forks_count);
          el.innerText = data.stargazers_count + " Stars · " + data.forks_count + " Forks"
        })
      }
    </script>

    <nav id="mainmenu" class="btn-group d-print-none" role="group" aria-label="Basic example">
      <a href="https://homieiot.github.io/" role="button" class="btn btn-main "
        title="">Overview</a>
      <a href="https://homieiot.github.io/specification/" role="button" class="btn btn-main "
        title="">Specification</a>
      <a href="https://homieiot.github.io/extensions/" role="button" class="btn btn-main "
        title="">Extensions</a>
      <a href="https://homieiot.github.io/implementations/" role="button" class="btn btn-main "
        title="">Implementations</a>
      <a href="https://homieiot.github.io/get_involved/" role="button" class="btn btn-main "
        title="">Get involved</a>
      <a href="https://homieiot.github.io/tools/" role="button" class="btn btn-main "
        title="">Tools</a>
    </nav>
  </header>
  
<div class="container mt-2" id="mainContent">
<div class="row">
<div class="col-12">
    <h1 class="animated fadeIn" style="text-align: center; margin-top:40px; font-size:4em;">
        Changes
    </h1>
    <center class="animated fadeIn mb-4">Changes from
        <a href='/specification/spec-core-v4_0_0/'>v4.0.0</a> to
        <a href='/specification/spec-core-v5_0_0/'>v5.0.0</a></center>

    <h2>Commits</h2>

    
    
    <table>
  <thead>
      <tr>
          <th>Commit title</th>
          <th>Date</th>
          <th>Hash</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>fix(links): https by default (#329)</td>
          <td>2025-05-11 18:06:49 +0200</td>
          <td>de48bf4</td>
      </tr>
      <tr>
          <td>change(definitions): adds top-level &lsquo;definitions&rsquo; section (#325)</td>
          <td>2025-04-10 21:38:10 +0200</td>
          <td>f23d619</td>
      </tr>
      <tr>
          <td>fix(step): add calculations for step rounding (#313)</td>
          <td>2024-12-09 07:54:48 +0100</td>
          <td>c782375</td>
      </tr>
      <tr>
          <td>fix(json): default should be an escaped json string (#308)</td>
          <td>2024-11-19 13:04:17 +0100</td>
          <td>f029eca</td>
      </tr>
      <tr>
          <td>change(version): remove &lsquo;higher&rsquo; constraint (#304)</td>
          <td>2024-10-27 19:32:53 +0100</td>
          <td>db70d60</td>
      </tr>
      <tr>
          <td>minor clarification in the base-topic (#303)</td>
          <td>2024-10-17 10:22:43 +0200</td>
          <td>063301d</td>
      </tr>
      <tr>
          <td>fix(enum): no duplicates (#302)</td>
          <td>2024-10-13 01:27:34 +0200</td>
          <td>aee10f3</td>
      </tr>
      <tr>
          <td>chor(node/prop): make &rsquo;name&rsquo; optional (#300)</td>
          <td>2024-09-07 13:33:16 +0200</td>
          <td>7cfd0b5</td>
      </tr>
      <tr>
          <td>fix: color encoding and brightness (#298)</td>
          <td>2024-09-04 22:17:02 +0200</td>
          <td>86f35d9</td>
      </tr>
      <tr>
          <td>chore(convention): minor cleanup and consistency updates</td>
          <td>2024-07-06 14:23:54 +0200</td>
          <td>0d7baf5</td>
      </tr>
      <tr>
          <td>Trigger website deployment on convention changes (#293)</td>
          <td>2024-07-04 10:25:15 +0200</td>
          <td>ce4f54a</td>
      </tr>
      <tr>
          <td>fix(logging): one level up in doc structure</td>
          <td>2024-07-03 14:54:46 +0200</td>
          <td>ce5e371</td>
      </tr>
      <tr>
          <td>chore(headings): move some headings</td>
          <td>2024-06-30 11:05:43 +0200</td>
          <td>63f21bd</td>
      </tr>
      <tr>
          <td>Correct topic pattern for empty string payload (#288)</td>
          <td>2024-02-17 18:20:16 +0200</td>
          <td>133c6b8</td>
      </tr>
      <tr>
          <td>homie5(alerts): replace &lsquo;alert&rsquo; state with alert-topic (#283)</td>
          <td>2023-11-15 23:38:52 +0100</td>
          <td>eb0b437</td>
      </tr>
      <tr>
          <td>fix(target): equality of received commands (#277)</td>
          <td>2023-11-13 11:23:55 +0100</td>
          <td>3715512</td>
      </tr>
      <tr>
          <td>homie5(type): add type field for device and node (#282)</td>
          <td>2023-11-05 12:12:29 +0100</td>
          <td>11f0378</td>
      </tr>
      <tr>
          <td>chore(state): add some more details around state management (#272)</td>
          <td>2023-11-05 10:59:14 +0100</td>
          <td>b314544</td>
      </tr>
      <tr>
          <td>fix(broadcast): broadcasted messages should be non-retained (#280)</td>
          <td>2023-11-05 10:48:22 +0100</td>
          <td>ed50bc6</td>
      </tr>
      <tr>
          <td>feat(unit): add &lsquo;rpm&rsquo; (revolutions per minute) (#279)</td>
          <td>2023-11-05 10:47:22 +0100</td>
          <td>1331fcc</td>
      </tr>
      <tr>
          <td>Added information about unpublishing/removing a device (#278)</td>
          <td>2023-11-05 10:45:02 +0100</td>
          <td>250d31a</td>
      </tr>
      <tr>
          <td>fix(log): clarify all messages must be non-retained (#276)</td>
          <td>2023-07-26 13:52:23 +0200</td>
          <td>c8201c8</td>
      </tr>
      <tr>
          <td>feat(color): allow to set a preferred format (#275)</td>
          <td>2023-07-06 11:07:52 +0200</td>
          <td>6eb4639</td>
      </tr>
      <tr>
          <td>feat(json-type): add a JSON data type (#273)</td>
          <td>2023-06-25 20:01:12 +0200</td>
          <td>566a2d6</td>
      </tr>
      <tr>
          <td>feat(log): change &ldquo;alert&rdquo; state, add logging (#262)</td>
          <td>2023-06-25 15:13:31 +0200</td>
          <td>adc710e</td>
      </tr>
      <tr>
          <td>feat(property): add an optional $target property (#263)</td>
          <td>2023-06-25 14:29:22 +0200</td>
          <td>611ec27</td>
      </tr>
      <tr>
          <td>clarify(enum): clarify that whitesapce is significant (#268)</td>
          <td>2023-06-25 10:00:24 +0200</td>
          <td>4bb1287</td>
      </tr>
      <tr>
          <td>chore(id): simplify ID checks (#261)</td>
          <td>2023-06-24 12:08:34 +0200</td>
          <td>da23e1f</td>
      </tr>
      <tr>
          <td>change(description): change arrays to objects (#270)</td>
          <td>2023-06-24 12:08:17 +0200</td>
          <td>015b328</td>
      </tr>
      <tr>
          <td>feat(format): add color format &lsquo;xyz&rsquo; (#274)</td>
          <td>2023-06-24 12:07:55 +0200</td>
          <td>1c15005</td>
      </tr>
      <tr>
          <td>fix(validation): specify float/int validation order (#269)</td>
          <td>2023-06-18 20:06:37 +0200</td>
          <td>13e241e</td>
      </tr>
      <tr>
          <td>fix(hierarchy): root device should not have root (#271)</td>
          <td>2023-06-18 20:05:06 +0200</td>
          <td>d6b4ad8</td>
      </tr>
      <tr>
          <td>chore(properties): align the 3 property tables in the spec (#267)</td>
          <td>2023-06-16 11:28:17 +0200</td>
          <td>35837c2</td>
      </tr>
      <tr>
          <td>chore(format): reformat table (flip-axis) for readability (#266)</td>
          <td>2023-06-16 09:28:16 +0200</td>
          <td>dbff282</td>
      </tr>
      <tr>
          <td>fix(example): no description update in &lsquo;ready&rsquo; state (#265)</td>
          <td>2023-06-15 09:32:00 +0200</td>
          <td>06446c0</td>
      </tr>
      <tr>
          <td>fix(format): properly format the integer format template (#264)</td>
          <td>2023-06-15 00:23:36 +0200</td>
          <td>c1a58ce</td>
      </tr>
      <tr>
          <td>chore(spec): spelling corrections (#260)</td>
          <td>2023-06-15 00:13:04 +0200</td>
          <td>9fa98ce</td>
      </tr>
      <tr>
          <td>fix(base-topic): some occurences of <code>homie/5/</code> were missing (#259)</td>
          <td>2023-03-19 13:58:20 +0100</td>
          <td>6afa235</td>
      </tr>
      <tr>
          <td>feat(formats): add step size to integer/float formats (#257)</td>
          <td>2023-03-17 13:45:02 +0100</td>
          <td>953a1e2</td>
      </tr>
      <tr>
          <td>feat(units): add airquality units; ppm (co2 / co)</td>
          <td>2023-03-12 13:20:46 +0100</td>
          <td>da5f1b4</td>
      </tr>
      <tr>
          <td>feat(units): add windspeed units; m/s + knots</td>
          <td>2023-03-07 11:10:07 +0100</td>
          <td>ce7a3ee</td>
      </tr>
      <tr>
          <td>fix(utf8): more explicit encoding details</td>
          <td>2023-03-07 11:01:06 +0100</td>
          <td>edf94b1</td>
      </tr>
      <tr>
          <td>change(description-doc): relax language about omitting defaults (#258)</td>
          <td>2023-03-17 13:42:05 +0100</td>
          <td>67e0ad7</td>
      </tr>
      <tr>
          <td>feat(units): add recommended units (#254)</td>
          <td>2023-03-04 15:29:08 +0100</td>
          <td>2fe6f7a</td>
      </tr>
      <tr>
          <td>change(QoS) clarify QoS settings and switch to 2 (#253)</td>
          <td>2023-01-26 10:32:56 +0100</td>
          <td>063578d</td>
      </tr>
      <tr>
          <td>refactor(mqtt) relocate all info wrt retained and qos (#252)</td>
          <td>2023-01-26 10:30:50 +0100</td>
          <td>c3f03bf</td>
      </tr>
      <tr>
          <td>fix(strings) use 0x00 instead of 0x00 (#251)</td>
          <td>2023-01-19 07:46:58 +0100</td>
          <td>158b873</td>
      </tr>
      <tr>
          <td>fix(version) device example missing required attribute (#250)</td>
          <td>2023-01-18 23:20:50 +0100</td>
          <td>d59d163</td>
      </tr>
      <tr>
          <td>feat(version) add version to description document</td>
          <td>2023-01-18 00:12:25 +0100</td>
          <td>4accccd</td>
      </tr>
      <tr>
          <td>feat(versioning) add improved versioning and compatibility</td>
          <td>2023-01-17 23:29:52 +0100</td>
          <td>4d10316</td>
      </tr>
      <tr>
          <td>fix(property) handling empty-string values (#239)</td>
          <td>2023-01-17 23:39:16 +0100</td>
          <td>734d6ff</td>
      </tr>
      <tr>
          <td>change(formats) float-colors, improved numbers, add booleans</td>
          <td>2023-01-17 07:46:27 +0100</td>
          <td>7e50cb1</td>
      </tr>
      <tr>
          <td>feat(units) add kW, kWh and m3 as units</td>
          <td>2023-01-17 06:50:42 +0100</td>
          <td>0f8439f</td>
      </tr>
      <tr>
          <td>readability(retained) reorder more logically (#245)</td>
          <td>2023-01-17 09:11:35 +0100</td>
          <td>1f73c11</td>
      </tr>
      <tr>
          <td>fix(device) be more specific about empty attributes (#242)</td>
          <td>2023-01-16 23:24:07 +0100</td>
          <td>f974349</td>
      </tr>
      <tr>
          <td>describe parent-child hierarchy and handling (#240)</td>
          <td>2023-01-16 23:23:29 +0100</td>
          <td>11dc08a</td>
      </tr>
      <tr>
          <td>fix(percent) drop the percent type (#243)</td>
          <td>2023-01-16 23:21:58 +0100</td>
          <td>0155f38</td>
      </tr>
      <tr>
          <td>drop node.$type field (#238)</td>
          <td>2023-01-16 20:12:34 +0100</td>
          <td>1c39612</td>
      </tr>
      <tr>
          <td>format required for enum and color types</td>
          <td>2023-01-15 22:06:14 +0100</td>
          <td>e2e8ce7</td>
      </tr>
      <tr>
          <td>drop separate v5 version</td>
          <td>2023-01-15 21:18:09 +0100</td>
          <td>5a34283</td>
      </tr>
      <tr>
          <td>readability; move long payload list to bottom of MQTT chapter</td>
          <td>2023-01-15 19:40:58 +0100</td>
          <td>9641bd0</td>
      </tr>
      <tr>
          <td>minor description-size improvements</td>
          <td>2023-01-15 02:08:15 +0100</td>
          <td>80f1772</td>
      </tr>
      <tr>
          <td>implement single description topic (JSON)</td>
          <td>2022-11-27 21:44:27 +0100</td>
          <td>c97eea9</td>
      </tr>
      <tr>
          <td>added 4.0 as the new 5.0 basis document</td>
          <td>2022-11-27 20:22:51 +0100</td>
          <td>1e0ec36</td>
      </tr>
      <tr>
          <td>fix(device) be more specific about empty attributes (#241)</td>
          <td>2023-01-16 23:22:30 +0100</td>
          <td>451c995</td>
      </tr>
      <tr>
          <td>chore(*) add design principles (#234)</td>
          <td>2023-01-15 19:20:56 +0100</td>
          <td>c0ba283</td>
      </tr>
      <tr>
          <td>clarify $format being required for enum and color (#224)</td>
          <td>2023-01-15 19:13:51 +0100</td>
          <td>bb5efc7</td>
      </tr>
      <tr>
          <td>chore(LICENSE): rename to get markdown rendering (#230)</td>
          <td>2022-10-06 18:36:48 +0200</td>
          <td>fd95584</td>
      </tr>
      <tr>
          <td>Update logo link</td>
          <td>2022-10-06 15:58:44 +0200</td>
          <td>84c1c13</td>
      </tr>
      <tr>
          <td>Fix: Added negative values to the valid range specification for floats</td>
          <td>2021-01-25 04:17:45 -0500</td>
          <td>fc643d6</td>
      </tr>
      <tr>
          <td>Add datetime and duration to datatype enum.</td>
          <td>2020-06-28 12:42:22 +0200</td>
          <td>1b3efa4</td>
      </tr>
      <tr>
          <td>Update convention.md</td>
          <td>2020-05-11 07:38:16 -0500</td>
          <td>dd6ee8e</td>
      </tr>
      <tr>
          <td>Update convention.md</td>
          <td>2020-05-11 07:31:26 -0500</td>
          <td>449d952</td>
      </tr>
      <tr>
          <td>Add implementation details and other things (#200)</td>
          <td>2020-05-06 13:21:50 +0200</td>
          <td>6d852df</td>
      </tr>
      <tr>
          <td>clarify broadcast topics</td>
          <td>2020-05-05 12:50:47 -0500</td>
          <td>d68076d</td>
      </tr>
      <tr>
          <td>added duration property</td>
          <td>2020-05-05 12:34:17 -0500</td>
          <td>9905706</td>
      </tr>
      <tr>
          <td>clarify percentage values</td>
          <td>2020-05-04 11:14:07 -0500</td>
          <td>8824393</td>
      </tr>
      <tr>
          <td>ready state clarification</td>
          <td>2020-04-28 13:20:44 -0500</td>
          <td>2c41d72</td>
      </tr>
      <tr>
          <td>added datetime payload</td>
          <td>2020-04-28 13:10:21 -0500</td>
          <td>b813a15</td>
      </tr>
      <tr>
          <td>clarification on allowed characters in topic ID</td>
          <td>2020-04-26 11:09:58 -0500</td>
          <td>2c28a5e</td>
      </tr>
      <tr>
          <td>Fix: Grammar fix (#187)</td>
          <td>2020-01-03 03:26:12 -0600</td>
          <td>6f3f98a</td>
      </tr>
  </tbody>
</table>

    

    <h2>Differences</h2>

    
    <table class="diff" id="difflib_chg_to5__top"
           cellspacing="0" cellpadding="0" rules="groups" >
        <colgroup></colgroup> <colgroup></colgroup> <colgroup></colgroup>
        <colgroup></colgroup> <colgroup></colgroup> <colgroup></colgroup>
        <thead><tr><th class="diff_next"><br /></th><th colspan="2" class="diff_header">v4.0.0</th><th class="diff_next"><br /></th><th colspan="2" class="diff_header">v5.0.0</th></tr></thead>
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__0"><a href="#difflib_chg_to5__1">n</a></td><td class="diff_header" id="from5_3">3</td><td >version: v<span class="diff_chg">4</span>.0.0</td><td class="diff_next"><a href="#difflib_chg_to5__1">n</a></td><td class="diff_header" id="to5_3">3</td><td >version: v<span class="diff_chg">5</span>.0.0</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_4">4</td><td ><span class="diff_sub">releasedate: 27. August 2019</span></td><td class="diff_next"></td><td class="diff_header" id="to5_4">4</td><td ><span class="diff_add">releasedate: 11. May 2025</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__1"><a href="#difflib_chg_to5__2">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__2">n</a></td><td class="diff_header" id="to5_11">11</td><td ><span class="diff_add">## Introduction</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_12">12</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_13">13</td><td ><span class="diff_add">​The Homie convention is an open standard framework designed to facilitate the</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_14">14</td><td ><span class="diff_add">communication and integration of Internet of Things (IoT) devices using the</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_15">15</td><td ><span class="diff_add">[MQTT protocol](https://mqtt.org).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_16">16</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_17">17</td><td ><span class="diff_add">In particular, the Homie convention defines a consistent topic structure and</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_18">18</td><td ><span class="diff_add">messaging format that enables devices to represent themselves, their data and</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_19">19</td><td ><span class="diff_add">their supported controls/commands in a uniform manner, enabling automatic</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_20">20</td><td ><span class="diff_add">discovery.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_21">21</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_22">22</td><td ><span class="diff_add">## Roles</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_23">23</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_24">24</td><td ><span class="diff_add">When interacting through a shared MQTT broker, implementations of the Homie</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_25">25</td><td ><span class="diff_add">convention can take on one or both of the following roles simultaneously:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_26">26</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_27">27</td><td ><span class="diff_add">- **Device**: an implementation that publishes the representation of a physical</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_28">28</td><td ><span class="diff_add">  appliance or logical entity, such as a car, a coffee machine or a protocol</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_29">29</td><td ><span class="diff_add">  bridge, to an MQTT broker.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_30">30</td><td ><span class="diff_add">- **Controller**: an implementation that discovers and interacts with *devices*</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_31">31</td><td ><span class="diff_add">  over MQTT. For example a mobile app, or an if-this-then-that rules engine.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_32">32</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_33">33</td><td ><span class="diff_add">Note that, for brevity and simplicity, the word &amp;quot;device&amp;quot; is often used</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_34">34</td><td ><span class="diff_add">to denote the combination of an appliance, the computer managing the appliance's</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_35">35</td><td ><span class="diff_add">MQTT representation and the representation itself.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_36">36</td><td ><span class="diff_add"> </span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__2"><a href="#difflib_chg_to5__3">n</a></td><td class="diff_header" id="from5_13">13</td><td >Homie communicates through [MQTT](http://mqtt.org) and is hence based on the basic principles of MQTT topic publication and subscription.</td><td class="diff_next"><a href="#difflib_chg_to5__3">n</a></td><td class="diff_header" id="to5_39">39</td><td >Homie communicates through [MQTT](http<span class="diff_add">s</span>://mqtt.org) and is hence based on the basic principles of MQTT topic publication and subscription.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__3"><a href="#difflib_chg_to5__4">n</a></td><td class="diff_header" id="from5_18">18</td><td >A topic level ID MAY contain lowercase letters from `a` to `z`, numbers from `0` to `9` as well as the hyphen character (`-`).</td><td class="diff_next"><a href="#difflib_chg_to5__4">n</a></td><td class="diff_header" id="to5_44">44</td><td >A topic level ID MAY<span class="diff_add"> ONLY</span> contain lowercase letters from `a` to `z`, numbers from `0` to `9` as well as the hyphen character (`-`).</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__4"><a href="#difflib_chg_to5__5">n</a></td><td class="diff_header" id="from5_20">20</td><td ><span class="diff_sub">A topic level ID MUST NOT start or end with a hyphen (`-`).</span></td><td class="diff_next"><a href="#difflib_chg_to5__5">n</a></td><td class="diff_header"></td><td ></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__5"><a href="#difflib_chg_to5__6">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__6">n</a></td><td class="diff_header" id="to5_48">48</td><td ><span class="diff_add">### QoS and retained messages</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_49">49</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_50">50</td><td ><span class="diff_add">The recommended QoS level is **Exactly once (QoS 2)** (except for non-retained, see below).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_51">51</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_52">52</td><td ><span class="diff_add">* All messages MUST be sent as **retained**, UNLESS stated otherwise.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_53">53</td><td ><span class="diff_add">* Controllers setting values for device properties publish to the Property `set` topic with **non-retained** messages only.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_54">54</td><td ><span class="diff_add">* Controllers setting values for **non-retained** device properties should publish to the Property `/set` topic with a QoS of **At most once (QoS 0)**.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_55">55</td><td ><span class="diff_add">* Devices publishing values for their **non-retained** properties must use **non-retained** messages, with a QoS of **At most once (QoS 0)**.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_56">56</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_57">57</td><td ><span class="diff_add">For QoS details see [the explanation](#qos-choices-explained).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_58">58</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_59">59</td><td ><span class="diff_add">### Last Will</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_60">60</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_61">61</td><td ><span class="diff_add">Homie requires the last will (LWT) to set the `homie` / `5` / `[device ID]` / `$state` attribute to the value **`lost`**, see [Device Lifecycle](#device-lifecycle).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_62">62</td><td ><span class="diff_add">MQTT only allows one last will message per connection, but since a device can have children, the LWT message MUST be set on the</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_63">63</td><td ><span class="diff_add">root device (the device at the root of the parent-child tree).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_64">64</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_65">65</td><td ><span class="diff_add">### Empty string values</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_66">66</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_67">67</td><td ><span class="diff_add">MQTT will treat an empty string payload as a "delete" instruction for the topic, therefor an</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_68">68</td><td ><span class="diff_add">empty string value is represented by a 1-character string containing a single byte value 0 (Hex: `0x00`, Dec: `0`).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_69">69</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_70">70</td><td ><span class="diff_add">The empty string (passed as an MQTT payload) can only occur in 3 places;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_71">71</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_72">72</td><td ><span class="diff_add">- `homie` / `5` / `[device ID]` / `[node ID]` / `[property ID]`; reported property values (for string types)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_73">73</td><td ><span class="diff_add">- `homie` / `5` / `[device ID]` / `[node ID]` / `[property ID]` / `set`; the topic to set properties (of string types)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_74">74</td><td ><span class="diff_add">- `homie` / `5` / `[device ID]` / `[node ID]` / `[property ID]` / `$target`; the target property value (for string types)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_75">75</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_76">76</td><td ><span class="diff_add">This convention specifies no way to represent an actual value of a 1-character string with a single byte 0. If a device</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_77">77</td><td ><span class="diff_add">needs this, then it should provide an escape mechanism on the application level.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_78">78</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_23">23</td><td >##<span class="diff_sub">#</span> Payload</td><td class="diff_next"></td><td class="diff_header" id="to5_79">79</td><td >## Payload<span class="diff_add">s</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__6"><a href="#difflib_chg_to5__7">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__7">n</a></td><td class="diff_header" id="to5_82">82</td><td ><span class="diff_add">- The message MUST NOT include the UTF-8 [BOM](https://en.wikipedia.org/wiki/Byte_order_mark)</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__7"><a href="#difflib_chg_to5__8">n</a></td><td class="diff_header" id="from5_28">28</td><td >###<span class="diff_sub">#</span> String</td><td class="diff_next"><a href="#difflib_chg_to5__8">n</a></td><td class="diff_header" id="to5_85">85</td><td >### String</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__8"><a href="#difflib_chg_to5__9">n</a></td><td class="diff_header" id="from5_31">31</td><td >- An empty string ("") is a valid payload</td><td class="diff_next"><a href="#difflib_chg_to5__9">n</a></td><td class="diff_header" id="to5_88">88</td><td >- An <span class="diff_add">[</span>empty string<span class="diff_add">](#empty-string-values)</span> ("") is a valid payload</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__9"><a href="#difflib_chg_to5__10">n</a></td><td class="diff_header" id="from5_33">33</td><td >###<span class="diff_sub">#</span> Integer</td><td class="diff_next"><a href="#difflib_chg_to5__10">n</a></td><td class="diff_header" id="to5_90">90</td><td >### Integer</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__10"><a href="#difflib_chg_to5__11">n</a></td><td class="diff_header" id="from5_35">35</td><td >- Integer types are<span class="diff_sub"> UTF-8 encoded</span> string literal representations of 64-bit signed whole numbers</td><td class="diff_next"><a href="#difflib_chg_to5__11">n</a></td><td class="diff_header" id="to5_92">92</td><td >- Integer types are string literal representations of 64-bit signed whole numbers</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__11"><a href="#difflib_chg_to5__12">n</a></td><td class="diff_header" id="from5_39">39</td><td >- An empty string ("") is not a valid payload</td><td class="diff_next"><a href="#difflib_chg_to5__12">n</a></td><td class="diff_header" id="to5_96">96</td><td >- An <span class="diff_add">[</span>empty string<span class="diff_add">](#empty-string-values)</span> ("") is not a valid payload</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__12"><a href="#difflib_chg_to5__13">n</a></td><td class="diff_header" id="from5_41">41</td><td >###<span class="diff_sub">#</span> Float</td><td class="diff_next"><a href="#difflib_chg_to5__13">n</a></td><td class="diff_header" id="to5_98">98</td><td >### Float</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__13"><a href="#difflib_chg_to5__14">n</a></td><td class="diff_header" id="from5_43">43</td><td >- Float types are<span class="diff_sub"> UTF-8 encoded</span> string literal representations of 64-bit signed floating point numbers</td><td class="diff_next"><a href="#difflib_chg_to5__14">n</a></td><td class="diff_header" id="to5_100">100</td><td >- Float types are string literal representations of 64-bit signed floating point numbers</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_44">44</td><td ><span class="diff_sub">- Floats range from 2&lt;sup&gt;-1074&lt;/sup&gt; to (2-2&lt;sup&gt;-52&lt;/sup&gt;)&amp;ast;2&lt;sup&gt;1023&lt;/sup&gt;</span></td><td class="diff_next"></td><td class="diff_header" id="to5_101">101</td><td ><span class="diff_add">- Floats range from +/-(2^-1074) to +/-((2 - 2^-52) * 2^1023)</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__14"><a href="#difflib_chg_to5__15">n</a></td><td class="diff_header" id="from5_49">49</td><td >- An empty string ("") is not a valid payload</td><td class="diff_next"><a href="#difflib_chg_to5__15">n</a></td><td class="diff_header" id="to5_106">106</td><td >- An <span class="diff_add">[</span>empty string<span class="diff_add">](#empty-string-values)</span> ("") is not a valid payload</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__15"><a href="#difflib_chg_to5__16">n</a></td><td class="diff_header" id="from5_51">51</td><td >###<span class="diff_sub">#</span> Boolean</td><td class="diff_next"><a href="#difflib_chg_to5__16">n</a></td><td class="diff_header" id="to5_108">108</td><td >### Boolean</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__16"><a href="#difflib_chg_to5__17">n</a></td><td class="diff_header" id="from5_55">55</td><td >- An empty string ("") is not a valid payload</td><td class="diff_next"><a href="#difflib_chg_to5__17">n</a></td><td class="diff_header" id="to5_112">112</td><td >- An <span class="diff_add">[</span>empty string<span class="diff_add">](#empty-string-values)</span> ("") is not a valid payload</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__17"><a href="#difflib_chg_to5__18">n</a></td><td class="diff_header" id="from5_57">57</td><td >###<span class="diff_sub">#</span> Enum</td><td class="diff_next"><a href="#difflib_chg_to5__18">n</a></td><td class="diff_header" id="to5_114">114</td><td >### Enum</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__18"><a href="#difflib_chg_to5__19">n</a></td><td class="diff_header" id="from5_61">61</td><td ><span class="diff_sub">- Payloads should have leading and trailing whitespace removed</span></td><td class="diff_next"><a href="#difflib_chg_to5__19">n</a></td><td class="diff_header" id="to5_118">118</td><td ><span class="diff_add">- Leading- and trailing-whitespace is significant, e.g. "Car" will not match " Car".</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_62">62</td><td >- An empty string ("") is not a valid payload</td><td class="diff_next"></td><td class="diff_header" id="to5_119">119</td><td >- An <span class="diff_add">[</span>empty string<span class="diff_add">](#empty-string-values)</span> ("") is not a valid payload</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__19"><a href="#difflib_chg_to5__20">n</a></td><td class="diff_header" id="from5_64">64</td><td >###<span class="diff_sub">#</span> Color</td><td class="diff_next"><a href="#difflib_chg_to5__20">n</a></td><td class="diff_header" id="to5_121">121</td><td >### Color</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__20"><a href="#difflib_chg_to5__21">n</a></td><td class="diff_header" id="from5_66">66</td><td >- Color payload validity varies depending on the property format definition of either "rgb"<span class="diff_chg"> or</span> "hsv"</td><td class="diff_next"><a href="#difflib_chg_to5__21">n</a></td><td class="diff_header" id="to5_123">123</td><td >- Color payload validity varies depending on the property format definition of either "rgb"<span class="diff_chg">,</span> "hsv"<span class="diff_add">, or "xyz"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_67">67</td><td ><span class="diff_sub">- Both payload types contain comma separated whole numbers of differing restricted ranges</span></td><td class="diff_next"></td><td class="diff_header" id="to5_124">124</td><td ><span class="diff_add">- All payload types contain comma-separated data of differing restricted ranges. The first being the type, followed by numbers. The numbers must conform to the [float](#float) format</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_68">68</td><td >- The encoded string may only contain <span class="diff_chg">w</span>hol<span class="diff_chg">e</span> numbers and the comma character ",", no other characters are permitted, including spaces (" ")</td><td class="diff_next"></td><td class="diff_header" id="to5_125">125</td><td >- The encoded string may only contain <span class="diff_chg">t</span>h<span class="diff_add">e type, the [fl</span>o<span class="diff_add">at](#f</span>l<span class="diff_chg">oat)</span> numbers and the comma character ",", no other characters are permitted, including spaces (" ")</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_69">69</td><td >- Payloads for type "rgb" contain<span class="diff_sub">s</span> 3 comma<span class="diff_chg"> </span>separated values of <span class="diff_chg">num</span>b<span class="diff_chg">ers</span> with a valid range between 0 and 255. e.g. 100,100,100</td><td class="diff_next"></td><td class="diff_header" id="to5_126">126</td><td >- Payloads for type "rgb" contain 3 comma<span class="diff_chg">-</span>separated values of <span class="diff_chg">[floats](#float) (`r`, `g`, `</span>b<span class="diff_chg">`)</span> with a valid range between 0 and 255<span class="diff_add"> (inclusive)</span>. e.g. <span class="diff_add">`"rgb,</span>100,100,100<span class="diff_add">"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_70">70</td><td ><span class="diff_sub">- Payloads for type "hsv" contains 3 comma separated values of numbers. The first number has a range of 0 to 360, the second and third numbers have a range of 0 to 100.  e.g. 300,50,75</span></td><td class="diff_next"></td><td class="diff_header" id="to5_127">127</td><td ><span class="diff_add">- Payloads for type "hsv" contain 3 comma-separated values of [floats](#float). The first number (`h`) has a range of 0 to 360 (inclusive), and the second and third numbers (`s` and `v`) have a range of 0 to 100 (inclusive).  e.g. `"hsv,300,50,75"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_128">128</td><td ><span class="diff_add">- Payloads for type "xyz" contain 2 comma separated values of [floats](#float) (`x`, `y`) with a valid range between 0 and 1 (inclusive). The "z" value can be calculated via `z=1-x-y` and is therefore not transmitted. (see [CIE_1931_color_space](https://en.wikipedia.org/wiki/CIE_1931_color_space)). e.g. `"xyz,0.25,0.34"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_129">129</td><td ><span class="diff_add">- *Note*: The `rgb` and `hsv` formats encode both color and brightness, whereas `xyz` only encodes the color, so;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_130">130</td><td ><span class="diff_add">  - when brightness encoding is required: do not use `xyz`, or optionally add another property for the brightness (such that setting `hsv` and `rgb` values changes both the color property and the brightness one if required)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_131">131</td><td ><span class="diff_add">  - if color only is encoded: ignore the `v` value in `hsv`, and use the relative colors of `rgb`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_132">132</td><td ><span class="diff_add">    eg. `color_only_r = 255 * r / max(r, g, b)`, etc.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_71">71</td><td >- An empty string ("") is not a valid payload</td><td class="diff_next"></td><td class="diff_header" id="to5_133">133</td><td >- An <span class="diff_add">[</span>empty string<span class="diff_add">](#empty-string-values)</span> ("") is not a valid payload</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_72">72</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__21"><a href="#difflib_chg_to5__22">n</a></td><td class="diff_header" id="from5_74">74</td><td ><span class="diff_sub">### QoS and retained messages</span></td><td class="diff_next"><a href="#difflib_chg_to5__22">n</a></td><td class="diff_header" id="to5_135">135</td><td ><span class="diff_add">### DateTime</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__22"><a href="#difflib_chg_to5__23">n</a></td><td class="diff_header" id="from5_76">76</td><td ><span class="diff_sub">The nature of the Homie convention makes it safe about duplicate messages, so the recommended QoS for reliability is **QoS 1**.</span></td><td class="diff_next"><a href="#difflib_chg_to5__23">n</a></td><td class="diff_header" id="to5_137">137</td><td ><span class="diff_add">- DateTime payloads must use the ISO [8601 format](https://en.wikipedia.org/wiki/ISO_8601). </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_77">77</td><td ><span class="diff_sub">All messages MUST be sent as **retained**, UNLESS stated otherwise.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_138">138</td><td ><span class="diff_add">- An [empty string](#empty-string-values) ("") is not a valid payload</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__23"><a href="#difflib_chg_to5__24">n</a></td><td class="diff_header" id="from5_79">79</td><td ><span class="diff_sub">### Last will</span></td><td class="diff_next"><a href="#difflib_chg_to5__24">n</a></td><td class="diff_header" id="to5_140">140</td><td ><span class="diff_add">### Duration</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__24"><a href="#difflib_chg_to5__25">n</a></td><td class="diff_header" id="from5_81">81</td><td ><span class="diff_sub">MQTT only allows one last will message per connection.</span></td><td class="diff_next"><a href="#difflib_chg_to5__25">n</a></td><td class="diff_header" id="to5_142">142</td><td ><span class="diff_add">- Duration payloads must use the [ISO 8601 duration format](https://en.wikipedia.org/wiki/ISO_8601#Durations)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_82">82</td><td ><span class="diff_sub">Homie requires the last will (LWT) to set the `homie` / `device ID` / `$state` attribute to the value **`lost`**, see [Device Lifecycle](#device-lifecycle).</span></td><td class="diff_next"></td><td class="diff_header" id="to5_143">143</td><td ><span class="diff_add">- The format is `PTxHxMxS`, where:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_83">83</td><td ><span class="diff_sub">As a consequence a new MQTT connection to the broker is required per published device.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_144">144</td><td ><span class="diff_add">`P`: Indicates a period/duration (required).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_145">145</td><td ><span class="diff_add">`T`: Indicates a time (required).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_146">146</td><td ><span class="diff_add">`xH`: Hours, where `x` represents the number of hours (optional).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_147">147</td><td ><span class="diff_add">`xM`: Minutes, where `x` represents the number of minutes (optional).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_148">148</td><td ><span class="diff_add">`xS`: Seconds, where `x` represents the number of seconds (optional).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_149">149</td><td ><span class="diff_add">- Examples: `PT12H5M46S` (12 hours, 5 minutes, 46 seconds), `PT5M` (5 minutes)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_150">150</td><td ><span class="diff_add">- An [empty string](#empty-string-values) ("") is not a valid payload</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__25"><a href="#difflib_chg_to5__26">n</a></td><td class="diff_header" id="from5_85">85</td><td ><span class="diff_sub">## Base Topic</span></td><td class="diff_next"><a href="#difflib_chg_to5__26">n</a></td><td class="diff_header" id="to5_152">152</td><td ><span class="diff_add">### JSON</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__26"><a href="#difflib_chg_to5__27">n</a></td><td class="diff_header" id="from5_87">87</td><td ><span class="diff_sub">The root topic in this document is `homie/`.</span></td><td class="diff_next"><a href="#difflib_chg_to5__27">n</a></td><td class="diff_header" id="to5_154">154</td><td ><span class="diff_add">- Contains a JSON string for transporting complex data formats that cannot be exposed as single value attributes.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_88">88</td><td ><span class="diff_sub">If this root topic does not suit your needs (in case of, e.g., a public broker or because of branding),</span></td><td class="diff_next"></td><td class="diff_header" id="to5_155">155</td><td ><span class="diff_add">- The payload MUST be either a JSON-Array or JSON-Object type, for other types the standard Homie types should be used.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_89">89</td><td ><span class="diff_sub">you can choose another.</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__27"><a href="#difflib_chg_to5__28">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__28">n</a></td><td class="diff_header" id="to5_157">157</td><td ><span class="diff_add">## Domain and Root Topic</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_158">158</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_159">159</td><td ><span class="diff_add">The root topic in this convention is `"homie/5/"`. It consists of 2 segments, the first being the homie-domain,</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_160">160</td><td ><span class="diff_add">and the second indicating the major version number of this convention.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_161">161</td><td ><span class="diff_add">The homie-domain must be a single segment and defaults to `"homie"`. If it does not suit your needs (in case of,</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_162">162</td><td ><span class="diff_add">e.g., a public broker or because of branding), you can change the domain part. The second segment, containing the version, may not be customized. This allows controllers to subscribe to only the devices they are compatible with.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_163">163</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_164">164</td><td ><span class="diff_add">## Auto-Discovery</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_165">165</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_91">91</td><td >Homie controllers must by default perform auto-discovery on the wildcard topic "+/+/$<span class="diff_chg">homi</span>e".</td><td class="diff_next"></td><td class="diff_header" id="to5_166">166</td><td >Homie<span class="diff_add"> 5</span> controllers must by default perform auto-discovery on the wildcard topic <span class="diff_add">`</span>"+<span class="diff_add">/5</span>/+/$<span class="diff_chg">stat</span>e"<span class="diff_add">`</span>.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_92">92</td><td >Controllers are free to restrict discovery to a specific <span class="diff_chg">r</span>oo<span class="diff_chg">t top</span>i<span class="diff_chg">c</span>, configurable by the user.</td><td class="diff_next"></td><td class="diff_header" id="to5_167">167</td><td >Controllers are free to restrict discovery to a specific <span class="diff_chg">h</span>o<span class="diff_add">mie-d</span>o<span class="diff_chg">ma</span>i<span class="diff_chg">n</span>, configurable by the user.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_168">168</td><td ><span class="diff_add">A zero length payload published on the `$state` topic indicates a device removal, see [device lifecycle](#device-lifecycle).</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__28"><a href="#difflib_chg_to5__29">n</a></td><td class="diff_header" id="from5_94">94</td><td ><span class="diff_sub">## Topology</span></td><td class="diff_next"><a href="#difflib_chg_to5__29">n</a></td><td class="diff_header" id="to5_170">170</td><td ><span class="diff_add">## Topology and structure</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__29"><a href="#difflib_chg_to5__30">n</a></td><td class="diff_header" id="from5_97">97</td><td ><span class="diff_sub">An instance of a physical piece of hardware is called a *device*.</span></td><td class="diff_next"><a href="#difflib_chg_to5__30">n</a></td><td class="diff_header" id="to5_173">173</td><td ><span class="diff_add">Within the convention devices can be modelled to have children. For example, bridge</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_98">98</td><td ><span class="diff_sub">For example, a car, an Arduino/ESP8266 or a coffee machine.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_174">174</td><td ><span class="diff_add">devices; a zwave bridge device (the parent) exposes many child devices (the</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_175">175</td><td ><span class="diff_add">zwave devices). There is no depth limit set on additionally nested children.</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__30"><a href="#difflib_chg_to5__31">n</a></td><td class="diff_header" id="from5_103">103</td><td >For example, a car might expose a `wheels` node, an `engine` node and a `lights` node.</td><td class="diff_next"><a href="#difflib_chg_to5__31">n</a></td><td class="diff_header" id="to5_180">180</td><td >For example, a car might expose a `wheels` node, an `engine` node<span class="diff_add">,</span> and a `lights` node.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__31"><a href="#difflib_chg_to5__32">n</a></td><td class="diff_header" id="from5_107">107</td><td >Properties represent basic characteristics of the node<span class="diff_sub">/device</span>, often given as numbers or finite states.</td><td class="diff_next"><a href="#difflib_chg_to5__32">n</a></td><td class="diff_header" id="to5_184">184</td><td >Properties represent basic characteristics of the node, often given as numbers or finite states.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_108">108</td><td >For example the `wheels` node might expose an `angle` property.</td><td class="diff_next"></td><td class="diff_header" id="to5_185">185</td><td >For example<span class="diff_add">,</span> the `wheels` node might expose an `angle` property.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_109">109</td><td >The `engine` node might expose a `speed`, `direction` and `temperature` property.</td><td class="diff_next"></td><td class="diff_header" id="to5_186">186</td><td >The `engine` node might expose a `speed`, `direction`<span class="diff_add">,</span> and `temperature` property.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__32"><a href="#difflib_chg_to5__33">n</a></td><td class="diff_header" id="from5_114">114</td><td >Attributes are represented by topic identifier starting with `$`.</td><td class="diff_next"><a href="#difflib_chg_to5__33">n</a></td><td class="diff_header" id="to5_191">191</td><td >Attributes are represented by<span class="diff_add"> a</span> topic identifier starting with `$`.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__33"><a href="#difflib_chg_to5__34">n</a></td><td class="diff_header" id="from5_121">121</td><td >* `homie` / **`device ID`**: this is the base topic of a device.</td><td class="diff_next"><a href="#difflib_chg_to5__34">n</a></td><td class="diff_header" id="to5_198">198</td><td >* `homie` /<span class="diff_add"> `5` /</span> **`<span class="diff_add">[</span>device ID<span class="diff_add">]</span>`**: this is the base topic of a device.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_122">122</td><td >Each device must have a unique device ID <span class="diff_chg">w</span>h<span class="diff_chg">ich</span> adhere to the [ID format](#topic-ids).</td><td class="diff_next"></td><td class="diff_header" id="to5_199">199</td><td >Each device must have a unique device ID <span class="diff_chg">t</span>h<span class="diff_chg">at</span> adhere<span class="diff_add">s</span> to the [ID format](#topic-ids).</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__34"><a href="#difflib_chg_to5__35">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__35">n</a></td><td class="diff_header" id="to5_203">203</td><td ><span class="diff_add">The following topic structure will be used to expose the device attributes:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_204">204</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_126">126</td><td >* `homie` / `device ID` / **`$device-attribute`**:</td><td class="diff_next"></td><td class="diff_header" id="to5_205">205</td><td >* `homie` / `<span class="diff_add">5` / `[</span>device ID<span class="diff_add">]</span>` / **`<span class="diff_add">[</span>$device-attribute<span class="diff_add">]</span>`**:</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__35"><a href="#difflib_chg_to5__36">n</a></td><td class="diff_header" id="from5_128">128</td><td ><span class="diff_sub">The following device attributes are mandatory and MUST be send, even if it is just an empty string.</span></td><td class="diff_next"><a href="#difflib_chg_to5__36">n</a></td><td class="diff_header" id="to5_207">207</td><td ><span class="diff_add">Devices have the following attributes:</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__36"><a href="#difflib_chg_to5__37">n</a></td><td class="diff_header" id="from5_130">130</td><td >| <span class="diff_chg">Top</span>i<span class="diff_chg">c    </span>   |                                                    Description            |</td><td class="diff_next"><a href="#difflib_chg_to5__37">n</a></td><td class="diff_header" id="to5_209">209</td><td >| <span class="diff_chg">Attr</span>i<span class="diff_chg">bute</span>   |<span class="diff_add"> Required |</span>                                                    Description            |</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_131">131</td><td >|-------------|----------------------------------------------------------------<span class="diff_sub">----------:</span>|</td><td class="diff_next"></td><td class="diff_header" id="to5_210">210</td><td >|---<span class="diff_add">----------|</span>----------|----------------------------------------------------------------|</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_132">132</td><td ><span class="diff_sub">| $homie      | The implemented Homie convention version                                  |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_211">211</td><td ><span class="diff_add">| `$state`      | yes | Reflects the current state of the device. See [Device Lifecycle](#device-lifecycle) |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_133">133</td><td ><span class="diff_sub">| $name       | Friendly name of the device                                               |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_212">212</td><td ><span class="diff_add">| `$description`| yes | The description document (JSON), describing the device, nodes, and properties of this device. **Important**: this value may only change when the device `$state` is either `init`, `disconnected`, or `lost`. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_134">134</td><td ><span class="diff_sub">| $state      | See [Device Lifecycle](#device-lifecycle)                                   |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_213">213</td><td ><span class="diff_add">| `$log`        | no | A topic that allows devices to log messages. See [Logging](#logging) |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_135">135</td><td ><span class="diff_sub">| $nodes      | [Nodes](#nodes) the device exposes, separated by `,` for multiple ones.   |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_136">136</td><td ><span class="diff_sub">| $extensions | Supported extensions, separated by `,` for multiple ones.                 |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__37"><a href="#difflib_chg_to5__38">n</a></td><td class="diff_header" id="from5_138">138</td><td ><span class="diff_sub">Optional topics include:</span></td><td class="diff_next"><a href="#difflib_chg_to5__38">n</a></td><td class="diff_header" id="to5_215">215</td><td ><span class="diff_add">The JSON description document is a JSON object with the following fields;</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__38"><a href="#difflib_chg_to5__39">n</a></td><td class="diff_header" id="from5_140">140</td><td ><span class="diff_sub">| Topic           | Description                   |</span></td><td class="diff_next"><a href="#difflib_chg_to5__39">n</a></td><td class="diff_header" id="to5_217">217</td><td ><span class="diff_add">| Field     | Type         | Required | Default | Nullable | Description |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_141">141</td><td ><span class="diff_sub">|-----------------|-------------------------------|</span></td><td class="diff_next"></td><td class="diff_header" id="to5_218">218</td><td ><span class="diff_add">|-----------|--------------|----------|---------|----------|-------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_142">142</td><td ><span class="diff_sub">| $implementation | An identifier for the Homie implementation (example "esp8266")                     |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_219">219</td><td ><span class="diff_add">| `homie`     |string        | yes      |         | no       | The implemented Homie convention version, without the "patch" level. So the format is `"5.x"`, where the `'x'` is the minor version. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_220">220</td><td ><span class="diff_add">| `version`   | integer      | yes      |         | no       | The version of the description document. Whenever the document changes, a new version must be assigned. This does not need to be sequential, eg. a timestamp or a random number could be used. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_221">221</td><td ><span class="diff_add">| `nodes`     |object        | no       | `{}`    | no       | The [Nodes](#nodes) the device exposes. An object containing the [Nodes](#nodes), indexed by their [ID](#topic-ids). Defaults to an empty object.|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_222">222</td><td ><span class="diff_add">| `name`      |string        | no       | [device-id] | no       | Friendly name of the device. Defaults to the [ID](#topic-ids) of the device. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_223">223</td><td ><span class="diff_add">| `type`      |string        | no       |         | no       | Type of Device. Please ensure proper namespacing to prevent naming collisions. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_224">224</td><td ><span class="diff_add">| `children`  |array-strings | no       | `[]`    | no       | Array of [ID](#topic-ids)'s of child devices. Defaults to an empty array.|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_225">225</td><td ><span class="diff_add">| `root`      |string        | yes/no   |         | no       | [ID](#topic-ids) of the root parent device. **Required** if the device is NOT the root device, MUST be omitted otherwise. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_226">226</td><td ><span class="diff_add">| `parent`    |string        | yes/no   | same as `root`| no | [ID](#topic-ids) of the parent device. **Required** if the parent is NOT the root device. Defaults to the value of the `root` property. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_227">227</td><td ><span class="diff_add">| `extensions`|array-strings | no       | `[]`    | no       | Array of supported extensions. Defaults to an empty array.|</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__39"><a href="#difflib_chg_to5__40">n</a></td><td class="diff_header" id="from5_144">144</td><td >For example, a device with an ID of `super-car` that comprises of a `wheels`, `engine` and a `lights` node would send:</td><td class="diff_next"><a href="#difflib_chg_to5__40">n</a></td><td class="diff_header" id="to5_229">229</td><td >For example, a device with an ID of `super-car` that comprises of a `wheels`, `engine`<span class="diff_add">,</span> and a `lights` node would send:</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_145">145</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__40"><a href="#difflib_chg_to5__41">n</a></td><td class="diff_header" id="from5_147">147</td><td ><span class="diff_sub">homie/super-car/$homie → "2.1.0"</span></td><td class="diff_next"><a href="#difflib_chg_to5__41">n</a></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_148">148</td><td ><span class="diff_sub">homie/super-car/$name → "Super car"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_149">149</td><td ><span class="diff_sub">homie/super-car/$nodes → "wheels,engine,lights"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_150">150</td><td ><span class="diff_sub">homie/super-car/$implementation → "esp8266"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_151">151</td><td >homie/super-car/$state → "<span class="diff_chg">ready</span>"</td><td class="diff_next"></td><td class="diff_header" id="to5_231">231</td><td >homie<span class="diff_add">/5</span>/super-car/$state → "<span class="diff_chg">init</span>"</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_232">232</td><td ><span class="diff_add">homie/5/super-car/$description → following JSON document;</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__41"><a href="#difflib_chg_to5__42">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__42">n</a></td><td class="diff_header" id="to5_234">234</td><td ><span class="diff_add">```json</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_235">235</td><td ><span class="diff_add">      {</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_236">236</td><td ><span class="diff_add">        "homie": "5.0",</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_237">237</td><td ><span class="diff_add">        "name": "Supercar",</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_238">238</td><td ><span class="diff_add">        "version": 7,</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_239">239</td><td ><span class="diff_add">        "nodes": { </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_240">240</td><td ><span class="diff_add">          "wheels": { ... },</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_241">241</td><td ><span class="diff_add">          "engine": { ... },</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_242">242</td><td ><span class="diff_add">          "lights": { ... }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_243">243</td><td ><span class="diff_add">        }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_244">244</td><td ><span class="diff_add">      }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_245">245</td><td ><span class="diff_add">```</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_246">246</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_247">247</td><td ><span class="diff_add">#### Device hierarchy</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_248">248</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_249">249</td><td ><span class="diff_add">Devices can be organized in parent-child relationships. These are expressed via the device</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_250">250</td><td ><span class="diff_add">attributes `root`, `parent`, and `children`. In any parent-child tree, there is only one</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_251">251</td><td ><span class="diff_add">"root" device, which is the top-level device that has no parent, but only children.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_252">252</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_253">253</td><td ><span class="diff_add">Example: a ZWave bridge (`id = "bridge"`), which exposes a ZWave device with a dual-relay (`id = "dualrelay"`),</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_254">254</td><td ><span class="diff_add">which respectively control Light1 (`id = "light1"`) and Light2 (`id = "light2"`). So there are 4 devices in total.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_255">255</td><td ><span class="diff_add">Then these are the attribute values:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_256">256</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_257">257</td><td ><span class="diff_add">|              | id          | children             | root     | parent      |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_258">258</td><td ><span class="diff_add">|--------------|-------------|----------------------|----------|-------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_259">259</td><td ><span class="diff_add">| Zwave bridge | "bridge"    | ["dualrelay"]        |          |             |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_260">260</td><td ><span class="diff_add">| Zwave relay  | "dualrelay" | ["light1", "light2"] | "bridge" |             |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_261">261</td><td ><span class="diff_add">| First light  | "light1"    |                      | "bridge" | "dualrelay" |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_262">262</td><td ><span class="diff_add">| Second light | "light2"    |                      | "bridge" | "dualrelay" |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_263">263</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_264">264</td><td ><span class="diff_add">To monitor the state of child devices in this tree 2 topic subscriptions are needed. The `$state` attribute of the device itself, as well as the `$state` attribute of its root device.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_265">265</td><td ><span class="diff_add">Because if the root device loses its connection to the MQTT server, the last will (LWT), will set its `$state` attribute to `"lost"`, but it will not update the child-device states. Hence the need for 2 topic subscriptions.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_266">266</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_267">267</td><td ><span class="diff_add">The `state` of any device should be determined as follows:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_268">268</td><td ><span class="diff_add">| has a `root` set | `root` state | device state |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_269">269</td><td ><span class="diff_add">|------------------|--------------|--------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_270">270</td><td ><span class="diff_add">| no               | n.a.         | device state is the `$state` attribute of the device itself</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_271">271</td><td ><span class="diff_add">| yes              | not `"lost"` | device state is the `$state` attribute of the device itself</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_272">272</td><td ><span class="diff_add">| yes              | `"lost"`     | device state is `"lost"` (`$state` attribute of the root device)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_273">273</td><td ><span class="diff_add"> </span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__42"><a href="#difflib_chg_to5__43">n</a></td><td class="diff_header" id="from5_156">156</td><td ><span class="diff_sub">The `$state` device attribute represents the current state of the device.</span></td><td class="diff_next"><a href="#difflib_chg_to5__43">n</a></td><td class="diff_header" id="to5_277">277</td><td ><span class="diff_add">The `$state` device attribute represents the current state of the device. A device exists once a valid value is set in the `$state` attribute. It doesn't mean the device is complete and valid (yet), but it does mean it exists.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_157">157</td><td ><span class="diff_sub">There are 6 different states:</span></td><td class="diff_next"></td><td class="diff_header" id="to5_278">278</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_279">279</td><td ><span class="diff_add">There are 5 possible state values:</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__43"><a href="#difflib_chg_to5__44">n</a></td><td class="diff_header" id="from5_160">160</td><td >This state is optional<span class="diff_sub">,</span> and may be sent if the device takes a long time to initialize, but wishes to announce to consumers that it is coming online. </td><td class="diff_next"><a href="#difflib_chg_to5__44">n</a></td><td class="diff_header" id="to5_282">282</td><td >This state is optional and may be sent if the device takes a long time to initialize, but wishes to announce to consumers that it is coming online. </td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_161">161</td><td ><span class="diff_sub">* **`ready`**: this is the state the device is in when it is connected to the MQTT broker, has sent all Homie messages and is ready to operate. A Homie Controller can assume default values for all optional topics.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_283">283</td><td ><span class="diff_add">A device may fall back into this state to do some reconfiguration.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_284">284</td><td ><span class="diff_add">* **`ready`**: this is the state the device is in when it is connected to the MQTT broker and has sent all Homie messages describing the device attributes, nodes, properties, and their values. The device has subscribed to all appropriate `/set` topics and is ready to receive messages. </span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__44"><a href="#difflib_chg_to5__45">n</a></td><td class="diff_header" id="from5_166">166</td><td ><span class="diff_sub">* **`lost`**: this is the state the device is in when the device has been "badly" disconnected.</span></td><td class="diff_next"><a href="#difflib_chg_to5__45">n</a></td><td class="diff_header" id="to5_289">289</td><td ><span class="diff_add">* **`lost`**: this is the state the device is in when the device has been "badly" disconnected. **Important**: If a root-device `$state` is `"lost"` then the state of **every child device in its tree** is also `"lost"`.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_167">167</td><td ><span class="diff_sub">You must define this message as LWT.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_290">290</td><td ><span class="diff_add">You must define this message as the last will (LWT) for root devices.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_168">168</td><td ><span class="diff_sub">* **`alert`**: this is the state the device is when connected to the MQTT broker, but something wrong is happening. E.g. a sensor is not providing data and needs human intervention.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_291">291</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_169">169</td><td ><span class="diff_sub">You have to send this message when something is wrong.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_292">292</td><td ><span class="diff_add">In order to permanently remove a device the following steps should be performed in order:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_293">293</td><td ><span class="diff_add">1. remove the retained `$state` attribute from the broker by publishing a zero length payload message to its topic. The device will cease to exist.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_294">294</td><td ><span class="diff_add">2. any other retained attributes or property values should be cleared via the same method afterwards.</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__45"><a href="#difflib_chg_to5__46">n</a></td><td class="diff_header" id="from5_173">173</td><td >* `homie` / `device ID` / **`node ID`**: this is the base topic of a node.</td><td class="diff_next"><a href="#difflib_chg_to5__46">n</a></td><td class="diff_header" id="to5_298">298</td><td >* `homie` / `<span class="diff_add">5` / `[</span>device ID<span class="diff_add">]</span>` / **`<span class="diff_add">[</span>node ID<span class="diff_add">]</span>`**: this is the base topic of a node.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_174">174</td><td >Each node must have a unique node ID on a per-device basis which adhere to the [ID format](#topic-ids).</td><td class="diff_next"></td><td class="diff_header" id="to5_299">299</td><td >Each node must have a unique node ID on a per-device basis which adhere<span class="diff_add">s</span> to the [ID format](#topic-ids).</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__46"><a href="#difflib_chg_to5__47">n</a></td><td class="diff_header" id="from5_178">178</td><td ><span class="diff_sub">* `homie` / `device ID` / `node ID` / **`$node-attribute`**:</span></td><td class="diff_next"><a href="#difflib_chg_to5__47">n</a></td><td class="diff_header" id="to5_303">303</td><td ><span class="diff_add">There are no node attributes in MQTT topics for this level.</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__47"><a href="#difflib_chg_to5__48">n</a></td><td class="diff_header" id="from5_180">180</td><td ><span class="diff_sub">All listed attributes are **required**. A node attribute MUST be one of these:</span></td><td class="diff_next"><a href="#difflib_chg_to5__48">n</a></td><td class="diff_header" id="to5_305">305</td><td ><span class="diff_add">The Node object itself is described in the `homie` / `5` / `[device ID]` / `$description` JSON document. The Node object has the following fields:</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__48"><a href="#difflib_chg_to5__49">n</a></td><td class="diff_header" id="from5_182">182</td><td ><span class="diff_sub">| Topic       | Description                                                                               |</span></td><td class="diff_next"><a href="#difflib_chg_to5__49">n</a></td><td class="diff_header" id="to5_307">307</td><td ><span class="diff_add">| Field       | Type         | Required | Default | Nullable | Description |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_183">183</td><td ><span class="diff_sub">|-------------|-------------------------------------------------------------------------------------------|</span></td><td class="diff_next"></td><td class="diff_header" id="to5_308">308</td><td ><span class="diff_add">|-------------|--------------|----------|---------|----------|-------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_184">184</td><td ><span class="diff_sub">| $name       | Friendly name of the Node                                                                 |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_309">309</td><td ><span class="diff_add">| `name`      |string        | no       | [node-id] | no       | Friendly name of the Node. Defaults to the [ID](#topic-ids) of the node. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_185">185</td><td ><span class="diff_sub">| $type       | Type of the node                                                                          |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_310">310</td><td ><span class="diff_add">| `type`      |string        | no       |         | no       | Type of Node. Please ensure proper namespacing to prevent naming collisions. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_186">186</td><td ><span class="diff_sub">| $properties | Exposed properties, separated by `,` for multiple ones.                                   |</span></td><td class="diff_next"></td><td class="diff_header" id="to5_311">311</td><td ><span class="diff_add">| `properties`|object        | no       | `{}`    | no       | The [Properties](#properties) the Node exposes. An object containing the [Properties](#properties), indexed by their [ID](#topic-ids). Defaults to an empty object.|</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__49"><a href="#difflib_chg_to5__50">n</a></td><td class="diff_header" id="from5_188">188</td><td >For example, our `engine` node would s<span class="diff_sub">end</span>:</td><td class="diff_next"><a href="#difflib_chg_to5__50">n</a></td><td class="diff_header" id="to5_313">313</td><td >For example, our `engine` node would <span class="diff_add">look like thi</span>s:</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__50"><a href="#difflib_chg_to5__51">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__51">n</a></td><td class="diff_header" id="to5_315">315</td><td ><span class="diff_add">```json</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_316">316</td><td ><span class="diff_add">      ...</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_317">317</td><td ><span class="diff_add">      "engine": {</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_318">318</td><td ><span class="diff_add">        "name": "Car engine",</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_319">319</td><td ><span class="diff_add">        "properties": {</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_320">320</td><td ><span class="diff_add">          "speed": { ... },</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_321">321</td><td ><span class="diff_add">          "direction": { ... },</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_322">322</td><td ><span class="diff_add">          "temperature": { ... }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_323">323</td><td ><span class="diff_add">        }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_324">324</td><td ><span class="diff_add">      }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_325">325</td><td ><span class="diff_add">      ...</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_326">326</td><td ><span class="diff_add">```</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_327">327</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_328">328</td><td ><span class="diff_add">### Properties</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_329">329</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_330">330</td><td ><span class="diff_add">* `homie` / `5` / `[device ID]` / `[node ID]` / **`[property ID]`**: this is the base topic of a property.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_331">331</td><td ><span class="diff_add">Each property must have a unique property ID on a per-node basis which adheres to the [ID format](#topic-ids).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_332">332</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_333">333</td><td ><span class="diff_add">#### Property Attributes</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_334">334</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_335">335</td><td ><span class="diff_add">| Attribute | Required |   Description            |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_336">336</td><td ><span class="diff_add">|-----------|----------|----------------------------------------------------------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_337">337</td><td ><span class="diff_add">|           | yes      | A property value (e.g. a sensor reading) is directly published to the property topic, e.g.: `homie/5/super-car/engine/temperature → "21.5"` |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_338">338</td><td ><span class="diff_add">| `$target` | no       | Describes an intended state change. The `$target` attribute must either be used for every value update (including the initial one), or it must never be used. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_339">339</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_340">340</td><td ><span class="diff_add">The Property object itself is described in the `homie` / `5` / `device ID` / `$description` JSON document. The Property object has the following fields:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_341">341</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_342">342</td><td ><span class="diff_add">| Field     | Type         | Required | Default  | Nullable | Description |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_343">343</td><td ><span class="diff_add">|-----------|--------------|----------|----------|----|---------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_344">344</td><td ><span class="diff_add">| `name`    | string       | no       | [property-id] | no | Friendly name of the Property. Defaults to the [ID](#topic-ids) of the property. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_345">345</td><td ><span class="diff_add">| `datatype`| string       | yes      |          | no | The data type. See [Payloads](#payload). Any of the following values: `"integer", "float", "boolean", "string", "enum", "color", "datetime", "duration", "json"`. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_346">346</td><td ><span class="diff_add">| `format`  | string       | see [formats](#formats)    | see [formats](#formats) | no | Specifies restrictions or options for the given data type. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_347">347</td><td ><span class="diff_add">| `settable`| boolean      | no       | `false`  | no | Whether the Property is settable. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_348">348</td><td ><span class="diff_add">| `retained`| boolean      | no       | `true`   | no | Whether the Property is retained. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_349">349</td><td ><span class="diff_add">| `unit`    | string       | no       |          | no | Unit of this property. See [units](#units). |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_350">350</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_351">351</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_352">352</td><td ><span class="diff_add">For example, our `temperature` property would look like this in the device/node description document:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_353">353</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_354">354</td><td ><span class="diff_add">```json</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_355">355</td><td ><span class="diff_add">      ...</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_356">356</td><td ><span class="diff_add">      "temperature": {</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_357">357</td><td ><span class="diff_add">        "name": "Engine temperature",</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_358">358</td><td ><span class="diff_add">        "unit": "°C",</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_359">359</td><td ><span class="diff_add">        "datatype": "float",</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_360">360</td><td ><span class="diff_add">        "format": "-20:120"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_361">361</td><td ><span class="diff_add">      }</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_362">362</td><td ><span class="diff_add">      ...</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_363">363</td><td ><span class="diff_add">```</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_364">364</td><td ><span class="diff_add">And the following MQTT topic with the reported property value:</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__51"><a href="#difflib_chg_to5__52">n</a></td><td class="diff_header" id="from5_191">191</td><td ><span class="diff_sub">homie/super-car/engine/$name → "Car engine"</span></td><td class="diff_next"><a href="#difflib_chg_to5__52">n</a></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_192">192</td><td ><span class="diff_sub">homie/super-car/engine/$type → "V8"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_193">193</td><td ><span class="diff_sub">homie/super-car/engine/$properties → "speed,direction,temperature"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_194">194</td><td ><span class="diff_sub">```</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_195">195</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_196">196</td><td ><span class="diff_sub">### Properties</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_197">197</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_198">198</td><td ><span class="diff_sub">* `homie` / `device ID` / `node ID` / **`property ID`**: this is the base topic of a property.</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_199">199</td><td ><span class="diff_sub">Each property must have a unique property ID on a per-node basis which adhere to the [ID format](#topic-ids).</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_200">200</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_201">201</td><td ><span class="diff_sub">* A property payload (e.g. a sensor reading) is directly published to the property topic, e.g.:</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_202">202</td><td ><span class="diff_sub">  ```java</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_203">203</td><td ><span class="diff_sub">  homie/super-car/engine/temperature → "21.5"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_204">204</td><td ><span class="diff_sub">  ```</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_205">205</td><td ><span class="diff_sub">  </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_206">206</td><td ><span class="diff_sub">* Properties can be **settable**.</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_207">207</td><td ><span class="diff_sub">  For example, you don't want your `temperature` property to be settable in case of a temperature sensor</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_208">208</td><td ><span class="diff_sub">  (like the car example), but to be settable in case of a thermostat.</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_209">209</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_210">210</td><td ><span class="diff_sub">* Properties can be **retained**.</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_211">211</td><td ><span class="diff_sub">  A property is retained by default. A non-retained property would be useful for momentary events (door bell pressed).</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_212">212</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_213">213</td><td ><span class="diff_sub">A combination of those flags compiles into this list:</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_214">214</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_215">215</td><td ><span class="diff_sub">* **retained + non-settable**: The node publishes a property state (temperature sensor)</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_216">216</td><td ><span class="diff_sub">* **retained + settable**: The node publishes a property state, and can receive commands for the property (by controller or other party) (lamp power)</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_217">217</td><td ><span class="diff_sub">* **non-retained + non-settable**: The node publishes momentary events (door bell pressed)</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_218">218</td><td ><span class="diff_sub">* **non-retained + settable**: The node publishes momentary events, and can receive commands for the property (by controller or other party) (brew coffee)</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_219">219</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_220">220</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_221">221</td><td ><span class="diff_sub">#### Property Attributes</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_222">222</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_223">223</td><td ><span class="diff_sub">* `homie` / `device ID` / `node ID` / `property ID` / **`$property-attribute`**:</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_224">224</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_225">225</td><td ><span class="diff_sub">The following attributes are required:</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_226">226</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_227">227</td><td ><span class="diff_sub">| Topic     | Description                                          | Payload type                                |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_228">228</td><td ><span class="diff_sub">|-----------|------------------------------------------------------|---------------------------------------------|</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_229">229</td><td ><span class="diff_sub">| $name     | Friendly name of the property.                       | String                                  |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_230">230</td><td ><span class="diff_sub">| $datatype | The data type. See [Payloads](#payloads).            | Enum: \[integer, float, boolean,string, enum, color\] |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_231">231</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_232">232</td><td ><span class="diff_sub">The following attributes are optional:</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_233">233</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_234">234</td><td ><span class="diff_sub">| Topic     | Description                                          |  Payload type                                |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_235">235</td><td ><span class="diff_sub">|-----------|------------------------------------------------------|---------------------------------------------|</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_236">236</td><td ><span class="diff_sub">| $format   | Specifies restrictions or options for the given data type | See below                                 |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_237">237</td><td ><span class="diff_sub">| $settable     | Settable (&lt;code&gt;true&lt;/code&gt;). Default is read-only (&lt;code&gt;false&lt;/code&gt;)  | Boolean     |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_238">238</td><td ><span class="diff_sub">| $retained     | Non-retained (&lt;code&gt;false&lt;/code&gt;). Default is Retained (&lt;code&gt;true&lt;/code&gt;).  | Boolean     |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_239">239</td><td ><span class="diff_sub">| $unit     | Optional unit of this property. See list below.  | String     |</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_240">240</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_241">241</td><td ><span class="diff_sub">For example, our `temperature` property would send:</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_242">242</td><td ><span class="diff_sub"> </span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_243">243</td><td ><span class="diff_sub">```java</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_244">244</td><td ><span class="diff_sub">homie/super-car/engine/temperature/$name → "Engine temperature"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_245">245</td><td ><span class="diff_sub">homie/super-car/engine/temperature/$settable → "false"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_246">246</td><td ><span class="diff_sub">homie/super-car/engine/temperature/$unit → "°C"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_247">247</td><td ><span class="diff_sub">homie/super-car/engine/temperature/$datatype → "float"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_248">248</td><td ><span class="diff_sub">homie/super-car/engine/temperature/$format → "-20:120"</span></td><td class="diff_next"></td><td class="diff_header"></td><td ></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_249">249</td><td >homie/super-car/engine/temperature → "21.5"</td><td class="diff_next"></td><td class="diff_header" id="to5_366">366</td><td >homie<span class="diff_add">/5</span>/super-car/engine/temperature → "21.5"</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__52"><a href="#difflib_chg_to5__53">n</a></td><td class="diff_header" id="from5_252">252</td><td ><span class="diff_sub">Format:</span></td><td class="diff_next"><a href="#difflib_chg_to5__53">n</a></td><td class="diff_header" id="to5_369">369</td><td ><span class="diff_add">#### Settable and retained properties</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__53"><a href="#difflib_chg_to5__54">n</a></td><td class="diff_header" id="from5_254">254</td><td ><span class="diff_sub">* For `integer` and `float`: Describes a range of payloads e.g. `10:15`</span></td><td class="diff_next"><a href="#difflib_chg_to5__54">n</a></td><td class="diff_header" id="to5_371">371</td><td ><span class="diff_add">Properties can be **settable** and/or **retained**. For example, you don't want your `temperature`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_255">255</td><td ><span class="diff_sub">* For `enum`: `payload,payload,payload` for enumerating all valid payloads.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_372">372</td><td ><span class="diff_add">property to be settable in case of a temperature sensor (like the car example), but it should be</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_256">256</td><td ><span class="diff_sub">* For `color`:</span></td><td class="diff_next"></td><td class="diff_header" id="to5_373">373</td><td ><span class="diff_add">settable in the case of a thermostat setpoint.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_257">257</td><td ><span class="diff_sub">  - `rgb` to provide colors in RGB format e.g. `255,255,0` for yellow.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_374">374</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_258">258</td><td ><span class="diff_sub">  - `hsv` to provide colors in HSV format e.g. `60,100,100` for yellow.</span></td><td class="diff_next"></td><td class="diff_header" id="to5_375">375</td><td ><span class="diff_add">A property is retained by default. A non-retained property would be useful for momentary events</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_376">376</td><td ><span class="diff_add">(e.g. doorbell pressed). See also [QoS settings](#qos-and-retained-messages).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_377">377</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_378">378</td><td ><span class="diff_add">A combination of the **settable** and **retained** flags compiles into this list:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_379">379</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_380">380</td><td ><span class="diff_add">| retained | settable | description |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_381">381</td><td ><span class="diff_add">|----------|----------|-------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_382">382</td><td ><span class="diff_add">| yes      | yes      | The node publishes a property state and can receive commands for the property (by a controller or other party) (lamp power)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_383">383</td><td ><span class="diff_add">| yes      | no       | (**default**) The node publishes a property state (temperature sensor)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_384">384</td><td ><span class="diff_add">| no       | yes      | The node publishes momentary events and can receive commands for the property from a controller (brew coffee)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_385">385</td><td ><span class="diff_add">| no       | no       | The node publishes momentary events (doorbell pressed)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_386">386</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_387">387</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_388">388</td><td ><span class="diff_add">#### Formats</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_389">389</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_390">390</td><td ><span class="diff_add">The format attribute specifies restrictions or options for the given data type. User interfaces can derive hints from</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_391">391</td><td ><span class="diff_add">the formats for displaying values.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_392">392</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_393">393</td><td ><span class="diff_add">| Type         | Required | Default | Description |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_394">394</td><td ><span class="diff_add">|--------------|----------|----------|-------------|</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_395">395</td><td ><span class="diff_add">| float        | no       | `:`      | `[min]:[max][:step]` where min and max are the respective minimum and maximum (inclusive) allowed values, both represented in the format for [float types](#float). Eg. `10.123:15.123`. If the minimum and/or maximum are missing from the format, then they are open-ended, so `0:` allows a value &gt;= 0.&lt;br/&gt;The optional `step` determines the step size, eg. `2:6:2` will allow values `2`, `4`, and `6`. It must be greater than 0. See notes below this table on calculations. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_396">396</td><td ><span class="diff_add">| integer      | no       | `:`      | `[min]:[max][:step]` where min and max are the respective minimum and maximum (inclusive) allowed values, both represented in the format for [integer types](#integer). Eg. `5:35`. If the minimum and/or maximum are missing from the format, then they are open-ended, so `:10` allows a value &lt;= 10. &lt;br/&gt;The optional `step` determines the step size, eg. `2:6:2` will allow values `2`, `4`, and `6`. It must be greater than 0. See notes below this table on calculations. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_397">397</td><td ><span class="diff_add">| enum         | yes      |          | A comma-separated list of non-quoted values. Eg. `value1,value2,value3`. Leading- and trailing whitespace is significant. Individual values can not be an empty string, hence at least 1 value must be specified in the format. Duplicates are not allowed. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_398">398</td><td ><span class="diff_add">| color        | yes      |          | A comma-separated list of color formats supported; `rgb`, `hsv`, and/or `xyz`. The formats should be listed in order of preference (most preferred first, least preferred last). See the [color type](#color) for the resulting value formats. E.g. a device supporting RGB and HSV, where RGB is preferred, would have its format set to `"rgb,hsv"`. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_399">399</td><td ><span class="diff_add">| boolean      | no       | `false,true` | Identical to an enum with 2 entries. The first represents the `false` value and the second is the `true` value. Eg. `close,open` or `off,on`. If provided, then both entries must be specified. **Important**:  the format does NOT specify valid payloads, they are descriptions of the valid payloads `false` and `true`. |</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_400">400</td><td ><span class="diff_add">| json         | no       | `{\"anyOf\": [{\"type\": \"array\"},{\"type\": \"object\"}]}` | A [JSONschema](https://json-schema.org/) definition, which is added as a string (escaped), NOT as a nested json-object. See [JSON considerations](#json-considerations), for some ideas wrt compatibility. If a client fails to parse/compile the JSONschema, then it should ignore the given schema and fall back to the default schema.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_401">401</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_402">402</td><td ><span class="diff_add">**Note on numeric formats and step-sizes**:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_403">403</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_404">404</td><td ><span class="diff_add">The base for calculating a proper value based on `step` should be `min`, `max`, or the current property value (in that order). The implementation should round property values to the nearest step (which can be outside the min/max range). The min/max validation must be done after rounding. In case of integers, the input MUST already be a valid integer, before rounding to a step.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_405">405</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_406">406</td><td ><span class="diff_add">There is a caveat when rounding towards a step: if the value to be rounded, is less than the base then the intermediate values might round differently since proper mathematical rounding is done "away from 0". A positive 1.5 rounds to 2 (so up), and negative -1.5 rounds to -2 (so down), but both round "away from 0". Example showing the unexpected effect:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_407">407</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_408">408</td><td ><span class="diff_add">input | format | result | explanation</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_409">409</td><td ><span class="diff_add">-|-|-|-</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_410">410</td><td ><span class="diff_add">`5` | `"0:10:2"` | `6` | base = 0; result = round((5-base)/stepsize) * stepsize + base = 6</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_411">411</td><td ><span class="diff_add">`5` | `":10:2"` | `4` | base = 10; result = round((5-base)/stepsize) * stepsize + base = 4</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_412">412</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_413">413</td><td ><span class="diff_add">To mitigate this do not use `round(x)`, but use `floor(x + 0.5)` instead. Such that rounding always goes up:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_414">414</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_415">415</td><td ><span class="diff_add">input | format | result | explanation</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_416">416</td><td ><span class="diff_add">-|-|-|-</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_417">417</td><td ><span class="diff_add">`5` | `"0:10:2"` | `6` | base = 0; result = floor((5-base)/stepsize + 0.5) * stepsize + base = 6</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_418">418</td><td ><span class="diff_add">`5` | `":10:2"`  | `6` | base = 10; result = floor((5-base)/stepsize + 0.5) * stepsize + base = 6</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_419">419</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_420">420</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_421">421</td><td ><span class="diff_add">#### Units</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__54"><a href="#difflib_chg_to5__55">n</a></td><td class="diff_header" id="from5_262">262</td><td ><span class="diff_sub">* `°C`: Degree Celsius</span></td><td class="diff_next"><a href="#difflib_chg_to5__55">n</a></td><td class="diff_header" id="to5_425">425</td><td ><span class="diff_add">* `°C`: Degree Celsius (see 'Degree' for encoding)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_263">263</td><td ><span class="diff_sub">* `°F`: Degree Fahrenheit</span></td><td class="diff_next"></td><td class="diff_header" id="to5_426">426</td><td ><span class="diff_add">* `°F`: Degree Fahrenheit (see 'Degree' for encoding)</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__55"><a href="#difflib_chg_to5__56">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__56">n</a></td><td class="diff_header" id="to5_428">428</td><td ><span class="diff_add">  * Character '°' is [Unicode: `U+00B0`](https://www.compart.com/en/unicode/U+00B0), Hex: `0xc2 0xb0`, Dec: `194 176`</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__56"><a href="#difflib_chg_to5__57">n</a></td><td class="diff_header" id="from5_266">266</td><td >* `gal`: Galon</td><td class="diff_next"><a href="#difflib_chg_to5__57">n</a></td><td class="diff_header" id="to5_430">430</td><td >* `gal`: Gal<span class="diff_add">l</span>on</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__57"><a href="#difflib_chg_to5__58">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__58">n</a></td><td class="diff_header" id="to5_433">433</td><td ><span class="diff_add">* `kW`: Kilowatt</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_434">434</td><td ><span class="diff_add">* `kWh`: Kilowatt-hour</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__58"><a href="#difflib_chg_to5__59">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__59">n</a></td><td class="diff_header" id="to5_436">436</td><td ><span class="diff_add">* `Hz`: Hertz</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_437">437</td><td ><span class="diff_add">* `rpm`: Revolutions per minute</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__59"><a href="#difflib_chg_to5__60">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__60">n</a></td><td class="diff_header" id="to5_440">440</td><td ><span class="diff_add">* `m³`: Cubic meter</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_441">441</td><td ><span class="diff_add">  * Character '³' is [Unicode: `U+00B3`](https://www.compart.com/en/unicode/U+00B3), Hex: `0xc2 0xb3`, Dec: `194 179`</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__60"><a href="#difflib_chg_to5__61">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__61">n</a></td><td class="diff_header" id="to5_443">443</td><td ><span class="diff_add">* `m/s`: Meters per Second</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_444">444</td><td ><span class="diff_add">* `kn`: Knots</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__61"><a href="#difflib_chg_to5__62">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__62">n</a></td><td class="diff_header" id="to5_447">447</td><td ><span class="diff_add">* `ppm`: Parts Per Million</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_448">448</td><td ><span class="diff_add">* `s`: Seconds</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_449">449</td><td ><span class="diff_add">* `min`: Minutes</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_450">450</td><td ><span class="diff_add">* `h`: Hours</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_451">451</td><td ><span class="diff_add">* `lx`: Lux</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_452">452</td><td ><span class="diff_add">* `K`: Kelvin</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_453">453</td><td ><span class="diff_add">* `MK⁻¹`: Mired</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_454">454</td><td ><span class="diff_add">  * Character '⁻' is [Unicode: `U+207B`](https://www.compart.com/en/unicode/U+207B), Hex: `0xe2 0x81 0xbb`, Dec: `226 129 187`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_455">455</td><td ><span class="diff_add">  * Character '¹' is [Unicode: `U+00B9`](https://www.compart.com/en/unicode/U+00B9), Hex: `0xc2 0xb9`, Dec: `194 185`</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__62"><a href="#difflib_chg_to5__63">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__63">n</a></td><td class="diff_header" id="to5_458">458</td><td ><span class="diff_add">The non-ASCII characters are specified as Unicode codepoints and the UTF-8 byte sequence that represents them. Since the same characters can be created in many visually similar ways it is important to stick to the exact byte sequences to enable proper interoperability.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_459">459</td><td ><span class="diff_add"> </span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__63"><a href="#difflib_chg_to5__64">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__64">n</a></td><td class="diff_header" id="to5_462">462</td><td ><span class="diff_add">#### Target attribute</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_463">463</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_464">464</td><td ><span class="diff_add">The `$target` attribute for properties allows a device to communicate an intended state change of a property. This serves 2 main</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_465">465</td><td ><span class="diff_add">purposes;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_466">466</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_467">467</td><td ><span class="diff_add">1. closing the control loop for a controller setting a value (if the property is settable).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_468">468</td><td ><span class="diff_add">2. feedback in case a change is not instantaneous (e.g. a light that slowly dimms over a longer period, or a</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_469">469</td><td ><span class="diff_add">   motorized valve that takes several minutes to fully open)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_470">470</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_471">471</td><td ><span class="diff_add">If implemented, then a device must first update the `$target` attribute, then start the transition (with</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_472">472</td><td ><span class="diff_add">optional state-value updates during the transition), and when done update the property value to match the</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_473">473</td><td ><span class="diff_add">`$target` value (functional equivalent, not necessarily a byte-by-byte equality).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_474">474</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_475">475</td><td ><span class="diff_add">If a new target is received (and accepted) from a controller by publishing to the property's `set` topic, then the exact value received must be published to the `$target` topic (byte-by-byte equality). To allow for closing the control loop.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_476">476</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_477">477</td><td ><span class="diff_add">**Notes:**</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_478">478</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_479">479</td><td ><span class="diff_add">- a controller can only assume that the command it send to the `set` topic was received and accepted. Not necessarily that it will ever reach the target state, since if another controller updates the property again, it might never reach the target state.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_480">480</td><td ><span class="diff_add">- The same goes for possible conversions (colors), rounding (number formats), etc. it will be very hard to check functional equivalence, since the value published may have a different format. So a controller should NOT implement a retry loop checking the final value. At best they should implement retries until the value set is being accepted.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_481">481</td><td ><span class="diff_add">- Homie devices representing remote hardware (typically when bridging) should NOT set the `$target` attribute upon receiving a change from the hardware device. This is only allowed if the hardware explicitly distinguishes between current value and target value. This is to prevent a loop; e.g. a homie controller sets 100% as target, software instructs hardware to change, intermediate updates received from hardware; 20%, 40%, etc, should NOT overwrite the `$target` value, since that still is 100.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_482">482</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_483">483</td><td ><span class="diff_add"> </span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__64"><a href="#difflib_chg_to5__65">n</a></td><td class="diff_header" id="from5_281">281</td><td >* `homie` / `device ID` / `node ID` / `property ID` / **`set`**: The device must subscribe to this topic if the property is **settable** (in case of actuators for example).</td><td class="diff_next"><a href="#difflib_chg_to5__65">n</a></td><td class="diff_header" id="to5_486">486</td><td >* `homie` / `<span class="diff_add">5` / `[</span>device ID<span class="diff_add">]</span>` / `<span class="diff_add">[</span>node ID<span class="diff_add">]</span>` / `<span class="diff_add">[</span>property ID<span class="diff_add">]</span>` / **`set`**: The device must subscribe to this topic if the property is **settable** (in<span class="diff_add"> the</span> case of actuators for example).</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__65"><a href="#difflib_chg_to5__66">n</a></td><td class="diff_header" id="from5_283">283</td><td >A Homie controller publishes to the `set` command topic with non-retained messages only.</td><td class="diff_next"><a href="#difflib_chg_to5__66">n</a></td><td class="diff_header" id="to5_488">488</td><td >A Homie controller publishes to the `set` command topic with non-retained messages only.<span class="diff_add"> See [retained messages](#qos-and-retained-messages).</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__66"><a href="#difflib_chg_to5__67">n</a></td><td class="diff_header" id="from5_285">285</td><td ><span class="diff_sub">The assigned and processed payload must be reflected by the Homie device in the property topic `homie` / `device ID` / `node ID` / `property ID` as soon as possible.</span></td><td class="diff_next"><a href="#difflib_chg_to5__67">n</a></td><td class="diff_header" id="to5_490">490</td><td ><span class="diff_add">The assigned and processed payload must be reflected by the Homie device in the property topic `homie` / `5` / `[device ID]` / `[node ID]` / `[property ID]` or target attribute `homie` / `5` / `[device ID]` / `[node ID]` / `[property ID]` / `$target` as soon as possible.</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__67"><a href="#difflib_chg_to5__68">n</a></td><td class="diff_header" id="from5_288">288</td><td >To give an example: A `kitchen-light` device exposing the `light` node with a settable `power` property subscribes to the topic `homie/kitchen-light/light/power/set` for commands:</td><td class="diff_next"><a href="#difflib_chg_to5__68">n</a></td><td class="diff_header" id="to5_493">493</td><td >To give an example: A `kitchen-light` device exposing the `light` node with a settable `power` property subscribes to the topic `homie<span class="diff_add">/5</span>/kitchen-light/light/power/set` for commands:</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__68"><a href="#difflib_chg_to5__69">n</a></td><td class="diff_header" id="from5_291">291</td><td >homie/kitchen-light/light/power/set ← "true"</td><td class="diff_next"><a href="#difflib_chg_to5__69">n</a></td><td class="diff_header" id="to5_496">496</td><td >homie<span class="diff_add">/5</span>/kitchen-light/light/power/set ← "true"</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__69"><a href="#difflib_chg_to5__70">n</a></td><td class="diff_header" id="from5_294">294</td><td >In response the device will turn on the light and upon success update its `power` property state accordingly:</td><td class="diff_next"><a href="#difflib_chg_to5__70">n</a></td><td class="diff_header" id="to5_499">499</td><td >In response<span class="diff_add">,</span> the device will turn on the light and upon success update its `power` property state accordingly:</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__70"><a href="#difflib_chg_to5__71">n</a></td><td class="diff_header" id="from5_297">297</td><td >homie/kitchen-light/light/power → "true"</td><td class="diff_next"><a href="#difflib_chg_to5__71">n</a></td><td class="diff_header" id="to5_502">502</td><td >homie<span class="diff_add">/5</span>/kitchen-light/light/power → "true"</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__71"><a href="#difflib_chg_to5__72">n</a></td><td class="diff_header" id="from5_300">300</td><td ><span class="diff_sub">## Broadcast Channel</span></td><td class="diff_next"><a href="#difflib_chg_to5__72">n</a></td><td class="diff_header" id="to5_505">505</td><td ><span class="diff_add">If the `light` were a dimmable light with a `brightness` property (0-100%), and it would be set to slowly dim over 5 seconds, then the `$target` attribute can be used (assuming once per second updates);</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__72"><a href="#difflib_chg_to5__73">n</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__73">n</a></td><td class="diff_header" id="to5_507">507</td><td ><span class="diff_add">```java</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_508">508</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness/set ← 100</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_509">509</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness/$target → 100</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_510">510</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness → 20  (after 1 second)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_511">511</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness → 40  (after 2 seconds)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_512">512</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness → 60  (after 3 seconds)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_513">513</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness → 80  (after 4 seconds)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_514">514</td><td ><span class="diff_add">homie/5/kitchen-light/light/brightness → 100  (after 5 seconds)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_515">515</td><td ><span class="diff_add">```</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_516">516</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_517">517</td><td ><span class="diff_add">## Alert topic</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_518">518</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_519">519</td><td ><span class="diff_add">Devices can raise alerts. Alerts are user facing messages that have an ID, they can be set and removed.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_520">520</td><td ><span class="diff_add">The alert topic is defined as;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_521">521</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_522">522</td><td ><span class="diff_add">* `homie` / `5` / `[device ID]` / `$alert` / `[alert ID]` → "alert message"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_523">523</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_524">524</td><td ><span class="diff_add">A device can raise a message on a specific ID. Once the alert is no longer usefull or has been resolved, it can be removed by deleting the topic. Alerts must be send as retained messages. The alert ID must have a valid [ID format](#topic-ids), where topic ID's starting with `$` are reserved for Homie usage.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_525">525</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_526">526</td><td ><span class="diff_add">Examples;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_527">527</td><td ><span class="diff_add">```java</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_528">528</td><td ><span class="diff_add">/homie/5/mydevid/$alert/childlost = "Sensor xyz in livingroom hasn't reported updates for 3 hours"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_529">529</td><td ><span class="diff_add">/homie/5/mydevid/$alert/battery = "Battery is low, at 8%"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_530">530</td><td ><span class="diff_add">```</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_531">531</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_532">532</td><td ><span class="diff_add">In the examples above, once the situation is resolved (the sensor comes back to live, or the batteries are replaced), the device will delete the topics again, indicating the alerts have been handled.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_533">533</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_534">534</td><td ><span class="diff_add">## Broadcast Topic</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_535">535</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_302">302</td><td >Homie defines a broadcast c<span class="diff_sub">hannel</span>, so a controller <span class="diff_chg">is </span>a<span class="diff_chg">ble to</span> broadcast a message to all Homie devices:</td><td class="diff_next"></td><td class="diff_header" id="to5_536">536</td><td >Homie defines a broadcast <span class="diff_add">topi</span>c, so a controller <span class="diff_chg">c</span>a<span class="diff_chg">n</span> broadcast a message to all Homie devices:</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__73"><a href="#difflib_chg_to5__74">n</a></td><td class="diff_header" id="from5_304">304</td><td ><span class="diff_sub">* `homie` / `$broadcast` / **`level`**: `level` is an arbitrary broadcast identifier.</span></td><td class="diff_next"><a href="#difflib_chg_to5__74">n</a></td><td class="diff_header" id="to5_538">538</td><td ><span class="diff_add">* `homie` / `5` / `$broadcast` / **`[subtopic]`**: where `subtopic` can be any topic with single or multiple levels. Each segement must adhere to the [ID format](#topic-ids).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_305">305</td><td ><span class="diff_sub">It must adhere to the [ID format](#topic-ids).</span></td><td class="diff_next"></td><td class="diff_header" id="to5_539">539</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_540">540</td><td ><span class="diff_add">The messages SHOULD be non-retained.</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__74"><a href="#difflib_chg_to5__75">n</a></td><td class="diff_header" id="from5_312">312</td><td >homie/$broadcast/alert ← "Intruder detected"</td><td class="diff_next"><a href="#difflib_chg_to5__75">n</a></td><td class="diff_header" id="to5_547">547</td><td >homie<span class="diff_add">/5</span>/$broadcast/alert ← "Intruder detected"</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_548">548</td><td ><span class="diff_add">homie/5/$broadcast/security/alert ← "Intruder detected"</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__75"><a href="#difflib_chg_to5__76">n</a></td><td class="diff_header" id="from5_315">315</td><td ><span class="diff_sub">Any other topic is not part of the Homie convention.</span></td><td class="diff_next"><a href="#difflib_chg_to5__76">n</a></td><td class="diff_header" id="to5_551">551</td><td ><span class="diff_add">## Logging</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_552">552</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_553">553</td><td ><span class="diff_add">Since devices may be resource constraint they might not have logging capabilities. Homie provides a specific</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_554">554</td><td ><span class="diff_add">topic where devices can send log messages. The topic is defined as;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_555">555</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_556">556</td><td ><span class="diff_add">* `homie` / `5` / `[device ID]` / `$log` / `[level]` </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_557">557</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_558">558</td><td ><span class="diff_add">The topic-value is the logged message, no sub-topics are allowed.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_559">559</td><td ><span class="diff_add">All log messages send should be non-retained.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_560">560</td><td ><span class="diff_add">The `level` is set according to the following table:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_561">561</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_562">562</td><td ><span class="diff_add">level   | description</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_563">563</td><td ><span class="diff_add">--------|------------</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_564">564</td><td ><span class="diff_add">`debug` | detailed information for troubleshooting purposes</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_565">565</td><td ><span class="diff_add">`info`  | informational message, device is working as expected</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_566">566</td><td ><span class="diff_add">`warn`  | something potentially harmful happened</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_567">567</td><td ><span class="diff_add">`error` | an error happened, the device will continue to operate but functionality might be impaired</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_568">568</td><td ><span class="diff_add">`fatal` | a non-recoverable error occured, operation of the device is likely suspended/stopped</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_569">569</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_570">570</td><td ><span class="diff_add">```java</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_571">571</td><td ><span class="diff_add">homie/5/my-device/$log/warn → "battery low"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_572">572</td><td ><span class="diff_add">homie/5/my-device/$log/error → "sensor value is out of range"</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_573">573</td><td ><span class="diff_add">```</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_574">574</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_575">575</td><td ><span class="diff_add">Note that MQTT is not meant to be a logging solution, and hence it should be used with care. The implementation should</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_576">576</td><td ><span class="diff_add">try and limit the traffic on the MQTT bus. If devices implement messages and levels that can be "noisy", then the</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_577">577</td><td ><span class="diff_add">device should provide a configuration option to turn them off, to limit the bandwidth consumed.</span></td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__76"><a href="#difflib_chg_to5__77">n</a></td><td class="diff_header" id="from5_319">319</td><td >This convention only covers discoverability of devices and i<span class="diff_chg">ts</span> capabilities.</td><td class="diff_next"><a href="#difflib_chg_to5__77">n</a></td><td class="diff_header" id="to5_581">581</td><td >This convention only covers<span class="diff_add"> the</span> discoverability of devices and <span class="diff_add">the</span>i<span class="diff_chg">r</span> capabilities.</td></tr>
            <tr><td class="diff_next"></td><td class="diff_header" id="from5_320">320</td><td >The aim is to have standardized MQTT topics for all kind of complex scenarios.</td><td class="diff_next"></td><td class="diff_header" id="to5_582">582</td><td >The aim is to have standardized MQTT topics for all kind<span class="diff_add">s</span> of complex scenarios.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__77"><a href="#difflib_chg_to5__78">n</a></td><td class="diff_header" id="from5_325">325</td><td >The proper term `homie` is reserved and must not be used as <span class="diff_chg">the</span> suffix or as part of the domain name.</td><td class="diff_next"><a href="#difflib_chg_to5__78">n</a></td><td class="diff_header" id="to5_587">587</td><td >The proper term `homie` is reserved and must not be used as <span class="diff_chg">a</span> suffix or as part of the domain name.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__78"><a href="#difflib_chg_to5__79">n</a></td><td class="diff_header" id="from5_331">331</td><td >The recommended license is the [CCA 4.0](https://homieiot.github.io/license)<span class="diff_sub">,</span> since this is the license Homie itself uses.</td><td class="diff_next"><a href="#difflib_chg_to5__79">n</a></td><td class="diff_header" id="to5_593">593</td><td >The recommended license is the [CCA 4.0](https://homieiot.github.io/license) since this is the license Homie itself uses.</td></tr>
        </tbody>        
        <tbody>
            <tr><td class="diff_next" id="difflib_chg_to5__79"><a href="#difflib_chg_to5__top">t</a></td><td class="diff_header"></td><td ></td><td class="diff_next"><a href="#difflib_chg_to5__top">t</a></td><td class="diff_header" id="to5_596">596</td><td ><span class="diff_add">## Implementation notes</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_597">597</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_598">598</td><td ><span class="diff_add">### Device initialization</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_599">599</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_600">600</td><td ><span class="diff_add">Some devices require knowledge of their settable retained properties to function properly.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_601">601</td><td ><span class="diff_add">The homie convention does not specify how to initialize/recover them e.g. after a power cycle.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_602">602</td><td ><span class="diff_add">A few common approaches are:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_603">603</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_604">604</td><td ><span class="diff_add">* A device can simply load default values from some configuration file.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_605">605</td><td ><span class="diff_add">* A device can restore its previous state from some local storage. This is the recommended way.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_606">606</td><td ><span class="diff_add">* A device may try to restore its state using MQTT. This can be done by subscribing to the respective channels.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_607">607</td><td ><span class="diff_add">  The controller could set all properties of a device once it becomes `ready`.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_608">608</td><td ><span class="diff_add">  An alternative way is to recover the state from other MQTT channels that are external to the Homie specification.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_609">609</td><td ><span class="diff_add">* If a property is not critical for correctly functioning, there is no need to recover it.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_610">610</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_611">611</td><td ><span class="diff_add">### Device reconfiguration</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_612">612</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_613">613</td><td ><span class="diff_add">If a device wishes to modify any of its nodes or properties, it can</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_614">614</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_615">615</td><td ><span class="diff_add">* disconnect and reconnect with other values, or</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_616">616</td><td ><span class="diff_add">* set `$state=init` and then modify any of the attributes.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_617">617</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_618">618</td><td ><span class="diff_add">Devices can remove old properties and nodes by deleting the respective MQTT topics by publishing an empty message</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_619">619</td><td ><span class="diff_add">to those topics (an actual empty string on MQTT level, so NOT the escaped `0x00` byte, see also [empty string values](#empty-string-values)).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_620">620</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_621">621</td><td ><span class="diff_add">When adding many child devices, implementations should take care of not publishing too many parent-updates, since every controller would have to parse the description again and again.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_622">622</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_623">623</td><td ><span class="diff_add">#### Adding children</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_624">624</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_625">625</td><td ><span class="diff_add">The recommended way to add child device is as follows:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_626">626</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_627">627</td><td ><span class="diff_add">1. first publish any child-devices, as any other device</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_628">628</td><td ><span class="diff_add">    1. set child-device state to `"init"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_629">629</td><td ><span class="diff_add">    1. publish child-device details (including parent details in `root` and `parent` fields)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_630">630</td><td ><span class="diff_add">    1. set child-device state to `"ready"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_631">631</td><td ><span class="diff_add">1. update the parent device, as any other change</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_632">632</td><td ><span class="diff_add">    1. set parent state to `"init"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_633">633</td><td ><span class="diff_add">    1. update parent description (add any child IDs to its `children` array)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_634">634</td><td ><span class="diff_add">    1. set parent state to `"ready"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_635">635</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_636">636</td><td ><span class="diff_add">Be aware that due to MQTT message ordering the consistency at any stage in this process cannot be guaranteed.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_637">637</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_638">638</td><td ><span class="diff_add">#### Removing children</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_639">639</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_640">640</td><td ><span class="diff_add">The recommended way to remove child device is as follows:</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_641">641</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_642">642</td><td ><span class="diff_add">1. update the parent device</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_643">643</td><td ><span class="diff_add">    1. set parent state to `"init"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_644">644</td><td ><span class="diff_add">    1. update parent description (remove any child IDs from its `children` array)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_645">645</td><td ><span class="diff_add">    1. set parent state to `"ready"`</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_646">646</td><td ><span class="diff_add">1. clear any child-device(s) topics, starting with the `$state` topic</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_647">647</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_648">648</td><td ><span class="diff_add">Be aware that due to MQTT message ordering the consistency at any stage in this process cannot be guaranteed.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_649">649</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_650">650</td><td ><span class="diff_add">### Versioning</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_651">651</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_652">652</td><td ><span class="diff_add">Some considerations related to versioning in this specification;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_653">653</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_654">654</td><td ><span class="diff_add">* compatibility is assumed to be major version only, so version 5 for this spec.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_655">655</td><td ><span class="diff_add">* the base topic includes the major version. This allows controllers to only subscribe to devices they are</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_656">656</td><td ><span class="diff_add">compatible with.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_657">657</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_658">658</td><td ><span class="diff_add">#### Backward compatibility</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_659">659</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_660">660</td><td ><span class="diff_add">* backward compatibility: a v5 controller controlling a v5 device with a smaller minor version. Eg. a v5.3 </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_661">661</td><td ><span class="diff_add">controller sending commands to a v5.0 device.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_662">662</td><td ><span class="diff_add">* Controllers should be aware of unsupported features in older major or minor versions they subscribe to because the spec for that version is known.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_663">663</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_664">664</td><td ><span class="diff_add">#### Forward compatibility</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_665">665</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_666">666</td><td ><span class="diff_add">* forward compatibility: a v5 controller controlling a v5 device with a higher minor version. Eg. a v5.0</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_667">667</td><td ><span class="diff_add">controller sending commands to a v5.2 device.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_668">668</td><td ><span class="diff_add">* Controllers should ignore unknown fields, properties, attributes, etc. within an object (device, node, or property), but keep the object itself.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_669">669</td><td ><span class="diff_add">* Controllers should ignore the entire object (device, node, or property) if in a known field, property, or attribute an illegal value is encountered. For example;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_670">670</td><td ><span class="diff_add">  * illegal characters in a topic or name</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_671">671</td><td ><span class="diff_add">  * unknown data type</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_672">672</td><td ><span class="diff_add">  * unknown/illegal format</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_673">673</td><td ><span class="diff_add">  * required element missing</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_674">674</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_675">675</td><td ><span class="diff_add">### JSON considerations</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_676">676</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_677">677</td><td ><span class="diff_add">Validation of JSON payloads is hard. The most common approach to validate JSON data is to use [JSONschema](https://json-schema.org/).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_678">678</td><td ><span class="diff_add">Unfortunately JSONschema is not a standard, it is a long list of mostly incompatible drafts of a potential standard. And as such one</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_679">679</td><td ><span class="diff_add">has to take into account the potential differences in implementations. This is about the JSONschema specifics itself as well as its reliance on RegEx engines for string validations, which are also known to be riddled with incompatibilities (typically language/platform specific).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_680">680</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_681">681</td><td ><span class="diff_add">The most popular JSONschema versions over time tend to be [`draft 4`](https://json-schema.org/specification-links.html#draft-4), [`draft 7`](https://json-schema.org/specification-links.html#draft-7) and the latest (at the time of writing) [`2020-12`](https://json-schema.org/specification-links.html#2020-12).</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_682">682</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_683">683</td><td ><span class="diff_add">General recommendations;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_684">684</td><td ><span class="diff_add">- If possible use a library that implements the latest JSONschema version available</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_685">685</td><td ><span class="diff_add">- When writing schema's make sure they are compatible with the popular versions mentioned above</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_686">686</td><td ><span class="diff_add">- Try to avoid RegEx'es, if you have to use them, then;</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_687">687</td><td ><span class="diff_add">  - restrict them to character classes and modifiers (`"+", "-", "*", "?"`)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_688">688</td><td ><span class="diff_add">  - do not use back-tracking and OR (`"|"`) constructs (the OR construct can typically be handled on the JSONschema level using an `anyOf` construct)</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_689">689</td><td ><span class="diff_add">- If a device fails to parse the JSONschema, or a RegEx, then by default it should skip validation and assume the payload is valid.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_690">690</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_691">691</td><td ><span class="diff_add">### QoS choices explained</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_692">692</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_693">693</td><td ><span class="diff_add">The nature of the Homie convention makes it safe about duplicate messages, so QoS levels for reliability **At least once (QoS 1)** </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_694">694</td><td ><span class="diff_add">and **Exactly once (QoS 2)** should both be fine. The recommended level is **Exactly once (QoS 2)**, since a resend on QoS 1 might have a different order, and hence is slightly less reliable, in case another device sends a new message that lands in between the 'send' and 'resend' of the first message. However, the probability of that happening is most likely negligible.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_695">695</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_696">696</td><td ><span class="diff_add">Keep in mind that if you change the QoS level to **At least once (QoS 1)**, then it should be done so for the entire Homie network.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_697">697</td><td ><span class="diff_add">Because the MQTT order will not hold if the QoS levels of messages are different. That said; anyone who accepts the lesser reliability of</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_698">698</td><td ><span class="diff_add">**At least once (QoS 1)**, will most likely also not care about the potential ordering issue of mixed QoS levels.</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_699">699</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_700">700</td><td ><span class="diff_add">For **non-retained** properties the QoS level is **At most once (QoS 0)** to ensure that events don't arrive late or multiple times. Because the events and commands are time-sensitive. With **At most once (QoS 0)** messages will not be queued by the broker for delivery if the subscriber (a device or controller) is currently disconnected. Which effectively translates to "either you get it now, or you don't get it at all".</span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_701">701</td><td ><span class="diff_add"> </span></td></tr>
            <tr><td class="diff_next"></td><td class="diff_header"></td><td ></td><td class="diff_next"></td><td class="diff_header" id="to5_702">702</td><td ><span class="diff_add"> </span></td></tr>
        </tbody>
    </table>
</div>
</div>
</div>


  
  <footer class="page-footer font-small blue pt-4">
      <div class="footer-copyright text-center py-3">© 2018-2025 -
      Made by IoT enthusiasts for IoT enthusiasts.
      </div>
  </footer>
  
</body>

</html>
