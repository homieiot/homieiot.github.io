<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/img/homie-logo.png">
  <link rel="canonical" href="https://homieiot.github.io/specification/preface/spec-core-develop/">
  <title>The Homie convention</title>
  <link href="https://homieiot.github.io/scss/all.min.css" rel="stylesheet">


    <script type='text/javascript' src="https://homieiot.github.io/js/main.min.js"></script>

  <link rel="prefetch" href="/specification/">
  <link rel="prefetch" href="/implementations/">
  <link rel="prefetch" href="/extensions/">
  <link rel="prefetch" href="/get_involved/">
  <link rel="prefetch" href="/license/">

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/js/sw.js')
      .catch(function(error) {
        console.log('Registration failed with ' + error);
      });
    }
  </script>
</head>

<body>
    <div class="progress d-print-none"></div>
    <header class="text-center" style="margin-top:20px">
    <a href="https://github.com/homieiot/convention" title="homieiot/convention" class="md-source d-print-none" data-md-source="github">
      <div class="md-source__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 416 448" id="__github">
          <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
                8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
                18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
                19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
                18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
                304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
                2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
                38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
                37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
                82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
                1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
                0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
                30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
                46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
                99.5z"></path>
        </svg>
      </div>
      <div class="md-source__repository">
        homieiot/convention
        <div id="repofacts" class="md-source__facts"></div>
      </div>
    </a>
    <script>
      const el = document.getElementById("repofacts");
      var stargazers_count = sessionStorage.getItem('stargazers_count');
      var forks_count = sessionStorage.getItem('forks_count');
      if (stargazers_count !== null) {
        el.innerText = stargazers_count + " Stars · " + forks_count + " Forks"
      } else {
        const url = "https://api.github.com/repos/homieiot\/convention"
        fetch(url).then(response => response.json()).then(data => {
          if (!(data instanceof Object))
            throw new TypeError
          sessionStorage.setItem('stargazers_count', data.stargazers_count);
          sessionStorage.setItem('forks_count', data.forks_count);
          el.innerText = data.stargazers_count + " Stars · " + data.forks_count + " Forks"
        })
      }
    </script>

    <nav id="mainmenu" class="btn-group d-print-none" role="group" aria-label="Basic example">
      <a href="https://homieiot.github.io/" role="button" class="btn btn-main "
        title="">Overview</a>
      <a href="https://homieiot.github.io/specification/" role="button" class="btn btn-main "
        title="">Specification</a>
      <a href="https://homieiot.github.io/extensions/" role="button" class="btn btn-main "
        title="">Extensions</a>
      <a href="https://homieiot.github.io/implementations/" role="button" class="btn btn-main "
        title="">Implementations</a>
      <a href="https://homieiot.github.io/get_involved/" role="button" class="btn btn-main "
        title="">Get involved</a>
      <a href="https://homieiot.github.io/tools/" role="button" class="btn btn-main "
        title="">Tools</a>
    </nav>
  </header>
  
<div class="container mt-2" id="mainContent">
<div class="row">
<div class="col-12">
    <h1 class="animated fadeIn" style="text-align: center; margin-top:40px; font-size:4em;">
        
    </h1>
    <center class="animated fadeIn mb-4"></center>
    <h2 id="mqtt-restrictions">MQTT Restrictions</h2>
<p>Homie communicates through <a href="http://mqtt.org">MQTT</a> and is hence based on the basic principles of MQTT topic publication and subscription.</p>
<h3 id="topic-ids">Topic IDs</h3>
<p>An MQTT topic consists of one or more topic levels, separated by the slash character (<code>/</code>).
A topic level ID MAY ONLY contain lowercase letters from <code>a</code> to <code>z</code>, numbers from <code>0</code> to <code>9</code> as well as the hyphen character (<code>-</code>).</p>
<p>A topic level ID MUST NOT start or end with a hyphen (<code>-</code>).
The special character <code>$</code> is used and reserved for Homie <em>attributes</em>.</p>
<h3 id="payload">Payload</h3>
<ul>
<li>Every MQTT message payload MUST be sent as a UTF-8 encoded string</li>
<li>The value published as payload MUST be valid for the respective property/attribute type as per the list below</li>
</ul>
<h4 id="string">String</h4>
<ul>
<li>String types are limited to 268,435,456 characters</li>
<li>An empty string (&quot;&quot;) is a valid payload</li>
</ul>
<h4 id="integer">Integer</h4>
<ul>
<li>Integer types are UTF-8 encoded string literal representations of 64-bit signed whole numbers</li>
<li>Integers range from -9,223,372,036,854,775,808 (-2<!-- raw HTML omitted -->63<!-- raw HTML omitted -->) to 9,223,372,036,854,775,807 (2<!-- raw HTML omitted -->63<!-- raw HTML omitted -->-1)</li>
<li>The payload may only contain whole numbers and the negation character &ldquo;-&rdquo;. No other characters including spaces (&quot; &ldquo;) are permitted</li>
<li>A string with just a negation sign (&quot;-&quot;) is not a valid payload</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h4 id="float">Float</h4>
<ul>
<li>Float types are UTF-8 encoded string literal representations of 64-bit signed floating point numbers</li>
<li>Floats range from 2<!-- raw HTML omitted -->-1074<!-- raw HTML omitted --> to (2-2<!-- raw HTML omitted -->-52<!-- raw HTML omitted -->)*2<!-- raw HTML omitted -->1023<!-- raw HTML omitted --></li>
<li>The payload may only contain whole numbers, the negation character &ldquo;-&rdquo;, the exponent character &ldquo;e&rdquo; or &ldquo;E&rdquo; and the decimal separator &ldquo;.&rdquo;, no other characters, including spaces (&rdquo; &ldquo;) are permitted</li>
<li>The dot character (&rdquo;.&quot;) is the decimal separator (used if necessary) and may only have a single instance present in the payload</li>
<li>Representations of numeric concepts such as &ldquo;NaN&rdquo; (Not a Number) and &ldquo;Infinity&rdquo; are not a valid payload</li>
<li>A string with just a negation sign (&quot;-&quot;) is not a valid payload</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h4 id="percent">Percent</h4>
<ul>
<li>Percent properties are set when the <code>$unit</code> attribute is set to <code>%</code></li>
<li>Percentage values maybe <a href="#integer">Integer</a> or <a href="#float">Float</a></li>
<li>Percentage values are not restricted to 0-100</li>
</ul>
<h4 id="boolean">Boolean</h4>
<ul>
<li>Booleans must be converted to the string literals &ldquo;true&rdquo; or &ldquo;false&rdquo;</li>
<li>Representation is case sensitive, e.g. &ldquo;TRUE&rdquo; or &ldquo;FALSE&rdquo; are not valid payloads.</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h4 id="enum">Enum</h4>
<ul>
<li>Enum payloads must be one of the values specified in the format definition of the property</li>
<li>Enum payloads are case sensitive, e.g. &ldquo;Car&rdquo; will not match a format definition of &ldquo;car&rdquo;</li>
<li>Payloads should have leading and trailing whitespace removed</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h4 id="color">Color</h4>
<ul>
<li>Color payload validity varies depending on the property format definition of either &ldquo;rgb&rdquo; or &ldquo;hsv&rdquo;</li>
<li>Both payload types contain comma separated whole numbers of differing restricted ranges</li>
<li>The encoded string may only contain whole numbers and the comma character &ldquo;,&rdquo;, no other characters are permitted, including spaces (&quot; &ldquo;)</li>
<li>Payloads for type &ldquo;rgb&rdquo; contains 3 comma separated values of numbers with a valid range between 0 and 255. e.g. 100,100,100</li>
<li>Payloads for type &ldquo;hsv&rdquo; contains 3 comma separated values of numbers. The first number has a range of 0 to 360, the second and third numbers have a range of 0 to 100.  e.g. 300,50,75</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h4 id="datetime">DateTime</h4>
<ul>
<li>DateTime payloads must use the ISO <a href="https://en.wikipedia.org/wiki/ISO_8601">8601 format</a>.</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h4 id="duration">Duration</h4>
<ul>
<li>Duration payloads must use the <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601 duration format</a></li>
<li>The format is PTHHMMSSS, where:
P: Required and indicates a duration.
T: Required and indicates a time.
H: Indicates hour and is preceded by the number of hours, if hours are specified.
M: Indicates minutes, and is preceded by the number of minutes, if minutes are specified.
S: Indicates seconds, preceded by the number of seconds, if seconds are specified.</li>
<li>An empty string (&quot;&quot;) is not a valid payload</li>
</ul>
<h3 id="qos-and-retained-messages">QoS and retained messages</h3>
<p>The nature of the Homie convention makes it safe about duplicate messages, so the recommended QoS for reliability is <strong>At least once (1)</strong>.
All messages MUST be sent as <strong>retained</strong>, UNLESS stated otherwise.</p>
<h3 id="last-will">Last will</h3>
<p>MQTT only allows one last will message per connection.
Homie requires the last will (LWT) to set the <code>homie</code> / <code>device ID</code> / <code>$state</code> attribute to the value <strong><code>lost</code></strong>, see <a href="#device-lifecycle">Device Lifecycle</a>.
As a consequence a new MQTT connection to the broker is required per published device.</p>
<h2 id="base-topic">Base Topic</h2>
<p>The root topic in this document is <code>homie/</code>.
If this root topic does not suit your needs (in case of, e.g., a public broker or because of branding),
you can choose another.</p>
<p>Homie controllers must by default perform auto-discovery on the wildcard topic &ldquo;+/+/$homie&rdquo;.
Controllers are free to restrict discovery to a specific root topic, configurable by the user.</p>
<h2 id="broadcast-topic">Broadcast Topic</h2>
<p>Homie defines a broadcast topic, so a controller is able to broadcast a message to all Homie devices:</p>
<ul>
<li><code>homie</code> / <code>$broadcast</code> / <strong><code>subtopic</code></strong>: <code>subtopic</code> can be any topic with single or multiple levels.
It must adhere to the <a href="#topic-ids">ID format</a>.</li>
</ul>
<p>For example, you might want to broadcast an <code>alert</code> event with the alert reason as the payload.
Devices are then free to react or not.
In our case, every buzzer of your home automation system would start buzzing.</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">homie</span><span class="o">/</span><span class="n">$broadcast</span><span class="o">/</span><span class="n">alert</span> <span class="err">←</span> <span class="s">&#34;Intruder detected&#34;</span>
<span class="n">homie</span><span class="o">/</span><span class="n">$broadcast</span><span class="o">/</span><span class="n">security</span><span class="o">/</span><span class="n">alert</span> <span class="err">←</span> <span class="s">&#34;Intruder detected&#34;</span>
</code></pre></div><p>Any other topic is not part of the Homie convention.</p>
<h2 id="extensions">Extensions</h2>
<p>This convention only covers discoverability of devices and its capabilities.
The aim is to have standardized MQTT topics for all kind of complex scenarios.
A Homie device may therefore support extensions, defined in separate documents.
Every extension is identified by a unique ID.</p>
<p>The ID consists of the reverse domain name and a freely chosen suffix.
The proper term <code>homie</code> is reserved and must not be used as the suffix or as part of the domain name.</p>
<p>For example, an organization <code>example.org</code> wanting to add a feature <code>our-feature</code> would choose the extension ID <code>org.example.our-feature</code>.</p>
<p>Every extension must be published using a license.
The license can be chosen freely, even proprietary licenses are possible.
The recommended license is the <a href="https://homieiot.github.io/license">CCA 4.0</a>, since this is the license Homie itself uses.</p>
<h2 id="implementation-notes">Implementation notes</h2>
<h3 id="device-initialization">Device initialization</h3>
<p>Some devices require knowledge of their settable retained properties to function properly.
The homie convention does not specify how to initialize/recover them e.g. after a power cycle.
A few common approaches are:</p>
<ul>
<li>A device can simply load default values from some configuration file.</li>
<li>A device can restore its previous state from some local storage. This is the recommended way.</li>
<li>A device may try to restore its state using MQTT. This can be done by subcribing to the respective channels.
The controller could set all properties of a device once it becomes <code>ready</code>.
An alternative way is to recover the state from other MQTT channels that are external to the Homie specification.</li>
<li>If a property is not critical for correct function, there is no need to recover it.</li>
</ul>
<h3 id="device-reconfiguration">Device reconfiguration</h3>
<p>If a device wishes to modify any of its nodes or properties, it can</p>
<ul>
<li>disconnect and reconnect with other values, or</li>
<li>set <code>$state=init</code> and then modify any of the attributes.</li>
</ul>
<p>Devices can remove old properties and nodes by publishing a zero-length payload on the respective topics.</p>

</div>
</div>
</div>


  
  <footer class="page-footer font-small blue pt-4">
      <div class="footer-copyright text-center py-3">© 2018-2020 -
      Made by IoT enthusiasts for IoT enthusiasts.
      </div>
  </footer>
  
</body>

</html>
